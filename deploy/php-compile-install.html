<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PHP7.4 编译安装 | A game without a solution</title>
    <meta name="description" content="Just taking notes">
    <link rel="stylesheet" href="/docs/assets/style.9f70d7ba.css">
    <link rel="modulepreload" href="/docs/assets/app.15e8eba7.js">
    <link rel="modulepreload" href="/docs/assets/deploy_php-compile-install.md.2d9a0027.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ca9ccb7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ca9ccb7e data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-a35e6f52><div class="container" data-v-a35e6f52><div class="VPNavBarTitle has-sidebar" data-v-a35e6f52 data-v-d5925166><a class="title" href="/docs/" data-v-d5925166><!--[--><!--]--><!----><!--[-->A game without a solution<!--]--><!--[--><!--]--></a></div><div class="content" data-v-a35e6f52><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a35e6f52 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/go/mac-install-go" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Go<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/k8s/introduction" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->K8S<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/deploy/introduction" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Deploy<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/rust/introduction" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->Rust<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a35e6f52 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-a3e7452b data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a35e6f52 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/sword-demon" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a35e6f52 data-v-e89b88d7 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e89b88d7><div class="item appearance" data-v-e89b88d7><p class="label" data-v-e89b88d7>Appearance</p><div class="appearance-action" data-v-e89b88d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-e89b88d7 data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e89b88d7><div class="item social-links" data-v-e89b88d7><div class="VPSocialLinks social-links-list" data-v-e89b88d7 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/sword-demon" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a35e6f52 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-ca9ccb7e data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-ca9ccb7e data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>简介</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/docs/deploy/introduction" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>介绍</span><!----><!--]--><!----></a><a class="VPLink link link active" href="/docs/deploy/php-compile-install" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>PHP7.4编译安装</span><!----><!--]--><!----></a><a class="VPLink link link" href="/docs/deploy/linux-install-nginx" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Linux安装配置nginx</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ca9ccb7e data-v-8af69dc9><div class="VPDoc has-sidebar has-aside" data-v-8af69dc9 data-v-f0af2311><div class="container" data-v-f0af2311><div class="aside" data-v-f0af2311><div class="aside-curtain" data-v-f0af2311></div><div class="aside-container" data-v-f0af2311><div class="aside-content" data-v-f0af2311><div class="VPDocAside" data-v-f0af2311 data-v-aea49c31><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-aea49c31 data-v-e03d48a8><div class="content" data-v-e03d48a8><div class="outline-marker" data-v-e03d48a8></div><div class="outline-title" data-v-e03d48a8>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-e03d48a8><span class="visually-hidden" id="doc-outline-aria-label" data-v-e03d48a8> Table of Contents for current page </span><ul class="root" data-v-e03d48a8><!--[--><li style="" data-v-e03d48a8><a class="outline-link" href="#下载安装-yum-源-centos7" data-v-e03d48a8>下载安装 yum 源(centos7)</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-sl-命令-小火车" data-v-e03d48a8>安装 sl 命令(小火车)</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-ipython-命令" data-v-e03d48a8>安装 ipython 命令</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-php7-4" data-v-e03d48a8>安装 PHP7.4</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-cmake-3-17-0-rc1" data-v-e03d48a8>安装 cmake-3.17.0-rc1</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-libzip-1-6-1" data-v-e03d48a8>安装 libzip-1.6.1</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-zip-1-17-1-扩展" data-v-e03d48a8>安装 zip-1.17.1 扩展</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#配置-php7-4" data-v-e03d48a8>配置 PHP7.4</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#php7-4-性能调优" data-v-e03d48a8>PHP7.4 性能调优</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#关于-opache-的一些配置" data-v-e03d48a8>关于 opache 的一些配置</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#thinkphp-开启二级域名" data-v-e03d48a8>ThinkPHP 开启二级域名</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#调整-php7-4-配置的一些内容" data-v-e03d48a8>调整 PHP7.4 配置的一些内容</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#php7-4-安装-swoole-扩展" data-v-e03d48a8>PHP7.4 安装 swoole 扩展</a><!----></li><li style="" data-v-e03d48a8><a class="outline-link" href="#安装-composer" data-v-e03d48a8>安装 composer</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-aea49c31></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0af2311><div class="content-container" data-v-f0af2311><!--[--><!--]--><main class="main" data-v-f0af2311><div style="position:relative;" class="vp-doc _docs_deploy_php-compile-install" data-v-f0af2311><div><h1 id="php7-4-编译安装" tabindex="-1">PHP7.4 编译安装 <a class="header-anchor" href="#php7-4-编译安装" aria-hidden="true">#</a></h1><h2 id="下载安装-yum-源-centos7" tabindex="-1">下载安装 yum 源(centos7) <a class="header-anchor" href="#下载安装-yum-源-centos7" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">wget http://mirror.centos.org/centos/7/extras/x86_64/Packages/epel-release-7-11.noarch.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">yum install -y epel-release-7-11.noarch.rpm</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="安装-sl-命令-小火车" tabindex="-1">安装 sl 命令(小火车) <a class="header-anchor" href="#安装-sl-命令-小火车" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install -y sl</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="安装-ipython-命令" tabindex="-1">安装 ipython 命令 <a class="header-anchor" href="#安装-ipython-命令" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install -y ipython</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="安装-php7-4" tabindex="-1">安装 PHP7.4 <a class="header-anchor" href="#安装-php7-4" aria-hidden="true">#</a></h2><p>首先准备一个 7.4 的源码包上传到<code>/usr/local/src</code>目录下，进行解压</p><p>然后查看 PHP7.4 需要安装的一些依赖</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">./configure --prefix=/usr/local/php7 --with-config-file-path=/usr/local/php7/etc  --with-mysqli   --with-pdo-mysql --with-xmlrpc --with-openssl --with-openssl-dir --with-zlib --with-zlib-dir  --with-freetype --enable-gd --with-jpeg  --enable-short-tags --enable-sockets --enable-soap --enable-mbstring --enable-static --with-curl  --with-xsl --enable-ftp --with-libxml  --enable-fpm --with-pdo-sqlite  --with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64  --with-pear --with-mhash  --enable-gd-jis-conv --enable-bcmath --with-expat --enable-inline-optimization --enable-mbregex --enable-opcache  --enable-sysvsem --enable-xml --enable-maintainer-zts  --enable-simplexml --disable-rpath --disable-fileinfo</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>​ 如果出现以下错误</p><blockquote><p>No package &#39;sqlite3&#39; found</p></blockquote><p>安装一下这个库即可</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install libsqlite3x-devel -y</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果出现以下错误：</p><blockquote><p>error: Package requirements (oniguruma) were not met</p></blockquote><p>安装如下依赖</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">yum install oniguruma-devel -y</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后再重更新运行上面配置代码</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">+--------------------------------------------------------------------+</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> License:                                                           </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> This software is subject to the PHP License, available </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> this     </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> distribution </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> the file LICENSE. By continuing this installation  </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> process, you are bound by the terms of this license agreement.     </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> If you </span><span style="color:#89DDFF;">do</span><span style="color:#A6ACCD;"> not agree with the terms of this license, you must abort </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> the installation process at this point.                            </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">+--------------------------------------------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Thank you </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> using PHP.</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>最终出现这个，就代表成功了。</p><p>下面就可以<code>make &amp;&amp; make intall</code>进行编译安装了</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">Installing shared extensions:     /usr/local/php7/lib/php/extensions/no-debug-zts-20190902/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP CLI binary:        /usr/local/php7/bin/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP CLI man page:      /usr/local/php7/php/man/man1/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP FPM binary:        /usr/local/php7/sbin/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP FPM defconfig:     /usr/local/php7/etc/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP FPM man page:      /usr/local/php7/php/man/man8/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP FPM status page:   /usr/local/php7/php/php/fpm/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing phpdbg binary:         /usr/local/php7/bin/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing phpdbg man page:       /usr/local/php7/php/man/man1/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP CGI binary:        /usr/local/php7/bin/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PHP CGI man page:      /usr/local/php7/php/man/man1/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing build environment:     /usr/local/php7/lib/php/build/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing header files:          /usr/local/php7/include/php/</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing helper programs:       /usr/local/php7/bin/</span></span>
<span class="line"><span style="color:#A6ACCD;">  program: phpize</span></span>
<span class="line"><span style="color:#A6ACCD;">  program: php-config</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing man pages:             /usr/local/php7/php/man/man1/</span></span>
<span class="line"><span style="color:#A6ACCD;">  page: phpize.1</span></span>
<span class="line"><span style="color:#A6ACCD;">  page: php-config.1</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PEAR environment:      /usr/local/php7/lib/php/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PEAR</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> Archive_Tar    - installed: 1.4.8</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PEAR</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> Console_Getopt - installed: 1.4.3</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PEAR</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> Structures_Graph- installed: 1.1.1</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PEAR</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> XML_Util       - installed: 1.4.3</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">PEAR</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> PEAR           - installed: 1.10.10</span></span>
<span class="line"><span style="color:#A6ACCD;">Wrote PEAR system config file at: /usr/local/php7/etc/pear.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">You may want to add: /usr/local/php7/lib/php to your php.ini include_path</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/local/src/php-7.4.2/build/shtool install -c ext/phar/phar.phar /usr/local/php7/bin</span></span>
<span class="line"><span style="color:#A6ACCD;">ln -s -f phar.phar /usr/local/php7/bin/phar</span></span>
<span class="line"><span style="color:#A6ACCD;">Installing PDO headers:           /usr/local/php7/include/php/ext/pdo/</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>出现上述内容，表示编译安装完成了。</p><h2 id="安装-cmake-3-17-0-rc1" tabindex="-1">安装 cmake-3.17.0-rc1 <a class="header-anchor" href="#安装-cmake-3-17-0-rc1" aria-hidden="true">#</a></h2><p>将下载好的包传到服务器<code>/usr/local/src</code>目录下进行解压</p><p>解压完进入目录中使用如下命令</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 cmake-3.17.0-rc1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ./bootstrap</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">-- Build files have been written to: /usr/local/src/cmake-3.17.0-rc1</span></span>
<span class="line"><span style="color:#A6ACCD;">---------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;">CMake has bootstrapped.  Now run gmake.</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>出现上述内容，根据它的提示运行<code>gmake</code>，等到<code>gmake</code>运行完了，再继续运行<code>make install</code>命令，这个速度会比较快。</p><p>然后我们就可以安装<code>libzip</code>组件</p><h2 id="安装-libzip-1-6-1" tabindex="-1">安装 libzip-1.6.1 <a class="header-anchor" href="#安装-libzip-1-6-1" aria-hidden="true">#</a></h2><p>我们先去找资源下载一个这个包，然后上传到<code>/usr/local/src</code>目录中并解压</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 src</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd libzip-1.6.1/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 libzip-1.6.1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># mkdir build</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 libzip-1.6.1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd build/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 build</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cmake ..</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最后出现以下内容即可</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">-- Configuring </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Generating </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Build files have been written to: /usr/local/src/libzip-1.6.1/build</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后就在<code>build</code>目录中进行<code>make &amp;&amp; make install</code>，这个速度也会挺快的。</p><p>安装成功出现下面的部分内容</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">-- Installing: /usr/local/bin/zipcmp</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Set runtime path of </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/zipcmp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> to </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Installing: /usr/local/bin/zipmerge</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Set runtime path of </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/zipmerge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> to </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Installing: /usr/local/bin/ziptool</span></span>
<span class="line"><span style="color:#A6ACCD;">-- Set runtime path of </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/bin/ziptool</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> to </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /etc/ld.so.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加内容</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">include ld.so.conf.d/*.conf</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/local/lib64</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/local/lib</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/lib</span></span>
<span class="line"><span style="color:#A6ACCD;">/usr/lib64</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后使用<code>lbconfig -v</code>查看一下即可</p><h2 id="安装-zip-1-17-1-扩展" tabindex="-1">安装 zip-1.17.1 扩展 <a class="header-anchor" href="#安装-zip-1-17-1-扩展" aria-hidden="true">#</a></h2><p>我们先去找资源下载一个这个包，然后上传到<code>/usr/local/src</code>目录中并解压</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 zip-1.17.1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/php7/bin/phpize</span></span>
<span class="line"><span style="color:#A6ACCD;">Configuring for:</span></span>
<span class="line"><span style="color:#A6ACCD;">PHP Api Version:         20190902</span></span>
<span class="line"><span style="color:#A6ACCD;">Zend Module Api No:      20190902</span></span>
<span class="line"><span style="color:#A6ACCD;">Zend Extension Api No:   320190902</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 zip-1.17.1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ./configure --with-php-config=/usr/local/php7/bin/php-config</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>出现以下内容即可</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">creating libtool</span></span>
<span class="line"><span style="color:#A6ACCD;">appending configuration tag </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">CXX</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> to libtool</span></span>
<span class="line"><span style="color:#A6ACCD;">configure: patching config.h.in</span></span>
<span class="line"><span style="color:#A6ACCD;">configure: creating ./config.status</span></span>
<span class="line"><span style="color:#A6ACCD;">config.status: creating config.h</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后编译安装</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 zip-1.17.1</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># make &amp;&amp; make install</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>就会出现以下结果</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">Build complete.</span></span>
<span class="line"><span style="color:#A6ACCD;">Don</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">t forget to run </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">make test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">Installing shared extensions:     /usr/local/php7/lib/php/extensions/no-debug-zts-20190902/</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="配置-php7-4" tabindex="-1">配置 PHP7.4 <a class="header-anchor" href="#配置-php7-4" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php-7.4.2</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd /usr/local/php7/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php7</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cp etc/php-fpm.conf.default etc/php-fpm.conf</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php7</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cp /usr/local/src/php-7.4.2/php.ini-development /usr/local/php7/etc/php.ini</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php7</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd /usr/local/php7/etc/php-fpm.d/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php-fpm.d</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cp www.conf.default www.conf</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>编辑<code>php.ini</code>加入<code>zip.so</code>扩展生效</p><div class="language-ini line-numbers-mode"><button class="copy"></button><span class="lang">ini</span><pre><code><span class="line"><span style="color:#676E95;">;extension=soap</span></span>
<span class="line"><span style="color:#676E95;">;extension=sockets</span></span>
<span class="line"><span style="color:#676E95;">;extension=sodium</span></span>
<span class="line"><span style="color:#676E95;">;extension=sqlite3</span></span>
<span class="line"><span style="color:#676E95;">;extension=tidy</span></span>
<span class="line"><span style="color:#676E95;">;extension=xmlrpc</span></span>
<span class="line"><span style="color:#676E95;">;extension=xsl</span></span>
<span class="line"><span style="color:#F07178;">extension</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">zip.so</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用<code>php-fpm</code>来启动</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php-fpm.d</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/php7/sbin/php-fpm</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php-fpm.d</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># netstat -tpln</span></span>
<span class="line"><span style="color:#A6ACCD;">Active Internet connections </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">only servers</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp        0      0 0.0.0.0:22              0.0.0.0:</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">               LISTEN      706/sshd</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp        0      0 127.0.0.1:9000          0.0.0.0:</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">               LISTEN      14896/php-fpm: mast</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp        0      0 0.0.0.0:111             0.0.0.0:</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">               LISTEN      357/rpcbind</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp        0      0 0.0.0.0:80              0.0.0.0:</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">               LISTEN      3295/nginx: master</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp6       0      0 :::22                   :::</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">                    LISTEN      706/sshd</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp6       0      0 :::33060                :::</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">                    LISTEN      1634/mysqld</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp6       0      0 :::3306                 :::</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">                    LISTEN      1634/mysqld</span></span>
<span class="line"><span style="color:#A6ACCD;">tcp6       0      0 :::111                  :::</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">                    LISTEN      357/rpcbind</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>然后我们将<code>php-fpm</code>加入到开机自启</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 php-fpm.d</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cd /usr/local/src/php-7.4.2/sapi/fpm/</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># cp init.d.php-fpm /etc/init.d/php-fpm7</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chmod a+x /etc/init.d/php-fpm7</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chkconfig php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">php-fpm             php-fpm.8.in        php-fpm.conf.in     php-fpm.service.in</span></span>
<span class="line"><span style="color:#A6ACCD;">php-fpm.8           php-fpm.conf        php-fpm.service</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chkconfig php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">php-fpm             php-fpm.8.in        php-fpm.conf.in     php-fpm.service.in</span></span>
<span class="line"><span style="color:#A6ACCD;">php-fpm.8           php-fpm.conf        php-fpm.service</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chkconfig php-fpm7 on</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     14896     1  0 15:59 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: master process </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">/usr/local/php7/etc/php-fpm.conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">nobody   14897 14896  0 15:59 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nobody   14898 14896  0 15:59 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15035  3378  0 16:06 pts/1    00:00:00 grep --color=auto php-fpm</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kill -9 14896</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kill -9 14897</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># kill -9 14898</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15037  3378  0 16:06 pts/1    00:00:00 grep --color=auto php-fpm</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># service php-fpm7 restart</span></span>
<span class="line"><span style="color:#A6ACCD;">Gracefully shutting down php-fpm warning, no pid file found - php-fpm is not running </span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">Starting php-fpm  </span><span style="color:#89DDFF;">done</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>查看是否进入开机启动项</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chkconfig php-fpm7 --list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Note: This output shows SysV services only and does not include native</span></span>
<span class="line"><span style="color:#A6ACCD;">      systemd services. SysV configuration data might be overridden by native</span></span>
<span class="line"><span style="color:#A6ACCD;">      systemd configuration.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      If you want to list systemd services use </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">systemctl list-unit-files</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">      To see services enabled on particular target use</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">systemctl list-dependencies [target]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">php-fpm7         0:off  1:off  2:on  3:on  4:on  5:on  6:off</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>只要 3，4，5 是<code>on</code>即可。</p><p>然后我们还需要配置<code>nginx.conf</code>可以使用<code>php</code></p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># vim /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.php$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">  127.0.0.1:9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_index </span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_param </span><span style="color:#A6ACCD;"> SCRIPT_FILENAME  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">fastcgi_script_name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">       fastcgi_params</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">root </span><span style="color:#A6ACCD;">  /home/web/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;"> index.php index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>修改上述内保存之后，重启以下<code>nginx</code></p><h3 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-hidden="true">#</a></h3><p>简单编写一个<code>index.php</code>，加入<code>phpinfo()</code>函数</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># vim /home/web/index.php</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 fpm</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chown -R nginx.nginx /home/web/</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后再次更新它的权限，再次访问我们的虚拟机的<code>ip</code>地址就会显示对应的<code>phpinfo</code>的内容</p><p>就可以看到下面几个依赖库的内容</p><h4 id="zip" tabindex="-1">zip <a class="header-anchor" href="#zip" aria-hidden="true">#</a></h4><table><thead><tr><th>Zip</th><th>enabled</th></tr></thead><tbody><tr><td>Zip version</td><td>1.17.1</td></tr><tr><td>Libzip headers version</td><td>1.6.1</td></tr><tr><td>Libzip library version</td><td>1.6.1</td></tr></tbody></table><h4 id="mysqli" tabindex="-1">mysqli <a class="header-anchor" href="#mysqli" aria-hidden="true">#</a></h4><table><thead><tr><th>MysqlI Support</th><th>enabled</th></tr></thead><tbody><tr><td>Client API library version</td><td>mysqlnd 7.4.2</td></tr><tr><td>Active Persistent Links</td><td>0</td></tr><tr><td>Inactive Persistent Links</td><td>0</td></tr><tr><td>Active Links</td><td>0</td></tr></tbody></table><h4 id="pdo-mysql" tabindex="-1">pdo_mysql <a class="header-anchor" href="#pdo-mysql" aria-hidden="true">#</a></h4><table><thead><tr><th>PDO Driver for MySQL</th><th>enabled</th></tr></thead><tbody><tr><td>Client API version</td><td>mysqlnd 7.4.2</td></tr></tbody></table><p>我们还要设置以下安装<code>nginx</code>的时候设置的<code>home/web/php7</code>目录下的一个<code>php7.conf</code></p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.php$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">  127.0.0.1:9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_index </span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_param </span><span style="color:#A6ACCD;"> SCRIPT_FILENAME  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">fastcgi_script_name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">       fastcgi_params</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>也加上上述内容即可。</p><p>完整内容</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># 监听端口号</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># 域名</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">www.php7.tt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># 网站目录</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/home/web/php7/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/</span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> ssi </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> ssi_silent_errors </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.php index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.php$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">  127.0.0.1:9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> fastcgi_index </span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">               </span><span style="color:#89DDFF;"> fastcgi_param </span><span style="color:#A6ACCD;"> SCRIPT_FILENAME  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">fastcgi_script_name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">       fastcgi_params</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_access.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>然后接着还是要重启以下<code>nginx</code></p><p>对应也对<code>php7</code>目录下新增一个<code>index.php</code>加入<code>phpinfo()</code>函数来测试以下是否成功。</p><h2 id="php7-4-性能调优" tabindex="-1">PHP7.4 性能调优 <a class="header-anchor" href="#php7-4-性能调优" aria-hidden="true">#</a></h2><p>给<code>php-fpm</code>添加日志文件目录</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># mkdir -p /usr/local/php7/log</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># chown -R nginx.nginx /usr/local/php7/</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后编辑</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;">#性能调优</span></span>
<span class="line"><span style="color:#A6ACCD;">vim /usr/local/php7/etc/php-fpm.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 将以下内容注释去掉</span></span>
<span class="line"><span style="color:#A6ACCD;">pid = run/php-fpm.pid</span></span>
<span class="line"><span style="color:#A6ACCD;">error_log = log/php-fpm.log</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/local/php7/etc/php-fpm.d/www.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 将下面内容进行替换为nginx用户</span></span>
<span class="line"><span style="color:#A6ACCD;">user = nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">group = nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># 如果 listen 监听的是9000那就不用管  暂时保存，下面还要设置内容</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15049     1  0 16:06 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: master process </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">/usr/local/php7/etc/php-fpm.conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">nobody   15050 15049  0 16:06 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nobody   15051 15049  0 16:06 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到这边还是<code>nobody</code>，我们需要重启以下<code>php-fpm7</code></p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># service php-fpm7 restart</span></span>
<span class="line"><span style="color:#A6ACCD;">Gracefully shutting down php-fpm </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">Starting php-fpm  </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15428  3378  0 16:26 pts/1    00:00:00 vim /usr/local/php7/etc/php-fpm.d/www.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15455     1  0 16:28 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: master process </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">/usr/local/php7/etc/php-fpm.conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15456 15455  0 16:28 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15457 15455  0 16:28 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><p>继续配置<code>vim /usr/local/php7/etc/php-fpm.d/www.conf</code></p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">pm</span><span style="color:#A6ACCD;"> = dynamic</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;"># 表示使用哪种进程数量管理方式</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p><code>dynamic</code>表示<code>php-fpm</code>进程数是动态的，最开始是<code>pms.start_servers</code>指定的数量，如果请求较多 ，则会自动增加，保证空闲的进程数不小于<code>pm.min_spare_servers</code>，如果进程数较多，也会进行相应清理，保证多余的进程数不多于<code>pm.max_spare_servers</code></p></li><li><p><code>static</code>表示<code>php-fpm</code>进程数是静态的, 进程数自始至终都是<code>pm.max_children</code>指定的数量，不再增加或减少</p></li></ul><p>此时<code>pm.max_children = 5</code>，我们可以先修改<code>pm</code>为<code>static</code>，重启<code>php-fpm7</code>来查看启动了多少个进程</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># service php-fpm7 restart</span></span>
<span class="line"><span style="color:#A6ACCD;">Gracefully shutting down php-fpm </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#A6ACCD;">Starting php-fpm  </span><span style="color:#89DDFF;">done</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15428  3378  0 16:26 pts/1    00:00:00 vim /usr/local/php7/etc/php-fpm.d/www.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15475     1  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: master process </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">/usr/local/php7/etc/php-fpm.conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15476 15475  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15477 15475  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15478 15475  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15479 15475  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15480 15475  0 16:31 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15482 29045  0 16:31 pts/0    00:00:00 grep --color=auto php-fpm</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><blockquote><p>所以<code>pm.max_children</code>这个参数只对静态模式下起作用。 静态模式下，我们最好设置为 100 个。</p></blockquote><p>我们最后还是改回动态模式，动态模式可以动态节省资源</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">The</span><span style="color:#A6ACCD;"> number of child processes created</span><span style="color:#89DDFF;"> on</span><span style="color:#A6ACCD;"> startup.</span></span>
<span class="line"><span style="color:#A6ACCD;">; Note: </span><span style="color:#89DDFF;">Used</span><span style="color:#A6ACCD;"> only when pm is set to </span><span style="color:#C3E88D;">&#39;dynamic&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">Default</span><span style="color:#A6ACCD;"> Value: (min_spare_servers + max_spare_servers) / 2</span></span>
<span class="line"><span style="color:#A6ACCD;">pm.</span><span style="color:#89DDFF;">start_servers</span><span style="color:#A6ACCD;"> = 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">The</span><span style="color:#A6ACCD;"> desired minimum number of idle server processes.</span></span>
<span class="line"><span style="color:#A6ACCD;">; Note: </span><span style="color:#89DDFF;">Used</span><span style="color:#A6ACCD;"> only when pm is set to </span><span style="color:#C3E88D;">&#39;dynamic&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">; Note: </span><span style="color:#89DDFF;">Mandatory</span><span style="color:#A6ACCD;"> when pm is set to </span><span style="color:#C3E88D;">&#39;dynamic&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">pm.</span><span style="color:#89DDFF;">min_spare_servers</span><span style="color:#A6ACCD;"> = 5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">The</span><span style="color:#A6ACCD;"> desired maximum number of idle server processes.</span></span>
<span class="line"><span style="color:#A6ACCD;">; Note: </span><span style="color:#89DDFF;">Used</span><span style="color:#A6ACCD;"> only when pm is set to </span><span style="color:#C3E88D;">&#39;dynamic&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">; Note: </span><span style="color:#89DDFF;">Mandatory</span><span style="color:#A6ACCD;"> when pm is set to </span><span style="color:#C3E88D;">&#39;dynamic&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">pm.</span><span style="color:#89DDFF;">max_spare_servers</span><span style="color:#A6ACCD;"> = 35</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>重启后观察效果</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ps -ef | grep php-fpm</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15428  3378  0 16:26 pts/1    00:00:00 vim /usr/local/php7/etc/php-fpm.d/www.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15652     1  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: master process </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">/usr/local/php7/etc/php-fpm.conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15653 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15654 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15655 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15656 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15657 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15658 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15659 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15660 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15661 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    15662 15652  0 16:40 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 php-fpm: pool www</span></span>
<span class="line"><span style="color:#A6ACCD;">root     15664 29045  0 16:40 pts/0    00:00:00 grep --color=auto php-fpm</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>我们最后给<code>pm.start_servers = 20</code>设置为 20 个</p><hr><blockquote><p><code>pm.max_requests</code>是发送多少个请求后会重启该线程，我们需要适当降低这个值，用以让<code>php-fpm</code>自动的释放内存</p></blockquote><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">The</span><span style="color:#A6ACCD;"> number of requests each child process should execute before respawning.</span></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">This</span><span style="color:#A6ACCD;"> can be useful to work around memory leaks in 3rd party libraries. For</span></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">endless</span><span style="color:#A6ACCD;"> request processing specify </span><span style="color:#C3E88D;">&#39;0&#39;</span><span style="color:#A6ACCD;">. Equivalent to PHP_FCGI_MAX_REQUESTS.</span></span>
<span class="line"><span style="color:#A6ACCD;">; </span><span style="color:#89DDFF;">Default</span><span style="color:#A6ACCD;"> Value: 0</span></span>
<span class="line"><span style="color:#A6ACCD;">pm.</span><span style="color:#89DDFF;">max_requests</span><span style="color:#A6ACCD;"> = 10240</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><p>开启慢查询</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">slowlog</span><span style="color:#A6ACCD;"> = log/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">pool.log.slow</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置超时时间 2 秒钟</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">request_slowlog_timeout</span><span style="color:#A6ACCD;"> = 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置最大执行时间</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">request_terminate_timeout</span><span style="color:#A6ACCD;"> = 30</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在<code>php.ini</code>中也可以进行配置(<code>max_execution_time</code>)</p><p>增加<code>php-fpm</code>打开文件描述符的限制</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">rlimit_files</span><span style="color:#A6ACCD;"> = 65535</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="关于-opache-的一些配置" tabindex="-1">关于 opache 的一些配置 <a class="header-anchor" href="#关于-opache-的一些配置" aria-hidden="true">#</a></h2><blockquote><p>测试环境或者开发环境不建议开，线上环境可以开</p></blockquote><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#A6ACCD;">zend_extension=opcache.</span><span style="color:#89DDFF;">so</span></span>
<span class="line"><span style="color:#A6ACCD;">;开启opcache</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.enable=</span><span style="color:#89DDFF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;CLI环境下，PHP启用OPcache</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.enable_cli=</span><span style="color:#89DDFF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;OPcache共享内存存储大小,单位MB</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.memory_consumption=</span><span style="color:#89DDFF;">128</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;PHP使用了一种叫做字符串驻留（</span><span style="color:#89DDFF;">string</span><span style="color:#A6ACCD;"> interning）的技术来改善性能。例如，如果你在代码中使用了1000次字符串“foobar”，在PHP内部只会在第一使用这个字符串的时候分配一个不可变的内存区域来存储这个字符串，其他的999次使用都会直接指向这个内存区域。这个选项则会把这个特性提升一个层次——默认情况下这个不可变的内存区域只会存在于单个php-fpm的进程中，如果设置了这个选项，那么它将会在所有的php-fpm进程中共享。在比较大的应用中，这可以非常有效地节约内存，提高应用的性能。</span></span>
<span class="line"><span style="color:#A6ACCD;">这个选项的值是以兆字节（megabytes）作为单位，如果把它设置为16，则表示16MB，默认是4MB</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.interned_strings_buffer=</span><span style="color:#89DDFF;">8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;这个选项用于控制内存中最多可以缓存多少个PHP文件。这个选项必须得设置得足够大，大于你的项目中的所有PHP文件的总和。</span></span>
<span class="line"><span style="color:#A6ACCD;">设置值取值范围最小值是 200，最大值在 </span><span style="color:#89DDFF;">PHP</span><span style="color:#A6ACCD;"> 5.5.6 之前是 100000，PHP </span><span style="color:#F78C6C;">5.5.6</span><span style="color:#A6ACCD;"> 及之后是 1000000。也就是说在200到1000000之间。</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.max_accelerated_files=</span><span style="color:#89DDFF;">10000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;设置缓存的过期时间（单位是秒）,为0的话每次都要检查</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.revalidate_freq=</span><span style="color:#89DDFF;">60</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;从字面上理解就是“允许更快速关闭”。它的作用是在单个请求结束时提供一种更快速的机制来调用代码中的析构器，从而加快PHP的响应速度和PHP进程资源的回收速度，这样应用程序可以更快速地响应下一个请求。把它设置为1就可以使用这个机制了。</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.fast_shutdown=</span><span style="color:#89DDFF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;如果启用（设置为1），OPcache会在opcache.revalidate_freq设置的秒数去检测文件的时间戳（timestamp）检查脚本是否更新。</span></span>
<span class="line"><span style="color:#A6ACCD;">如果这个选项被禁用（设置为0），opcache.revalidate_freq会被忽略，PHP文件永远不会被检查。这意味着如果你修改了你的代码，然后你把它更新到服务器上，再在浏览器上请求更新的代码对应的功能，你会看不到更新的效果</span></span>
<span class="line"><span style="color:#A6ACCD;">强烈建议你在生产环境中设置为0，更新代码后，再平滑重启PHP和web服务器。</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.validate_timestamps=</span><span style="color:#89DDFF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">;开启Opcache </span><span style="color:#89DDFF;">File</span><span style="color:#A6ACCD;"> Cache(实验性), 通过开启这个, 我们可以让Opcache把opcode缓存缓存到外部文件中, 对于一些脚本, 会有很明显的性能提升.</span></span>
<span class="line"><span style="color:#A6ACCD;">这样PHP就会在/tmp目录下Cache一些Opcode的二进制导出文件, 可以跨PHP生命周期存在.</span></span>
<span class="line"><span style="color:#A6ACCD;">opcache.file_cache=/</span><span style="color:#89DDFF;">tmp</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="thinkphp-开启二级域名" tabindex="-1">ThinkPHP 开启二级域名 <a class="header-anchor" href="#thinkphp-开启二级域名" aria-hidden="true">#</a></h2><p>在<code>nginx</code>对应的设置的<code>php的项目的conf</code>文件加上</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^(.*)$</span><span style="color:#F07178;">  /index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">break;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>开启二级域名</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/youdomain/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename)</span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^/youdomain/(.*)$</span><span style="color:#F07178;">  /youdomain/index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>完整内容</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 监听端口号</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 域名</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">www.php7.tt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># 网站目录</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/home/web/php7/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/</span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssi </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssi_silent_errors </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.php index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\.php$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">  127.0.0.1:9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> fastcgi_index </span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> fastcgi_param </span><span style="color:#A6ACCD;"> SCRIPT_FILENAME  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">fastcgi_script_name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">       fastcgi_params</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># nginx 开启rewrite</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^(.*)$</span><span style="color:#F07178;">  /index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">break;</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># nginx开启二级域名</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/youdomain/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename)</span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">             </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^/youdomain/(.*)$</span><span style="color:#F07178;">  /youdomain/index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_access.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>或者在<code>ThinkPHP</code>的<code>public</code>目录下的<code>htaccess.conf</code>文件里设置</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#开启压缩</span></span>
<span class="line"><span style="color:#89DDFF;">gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_buffers </span><span style="color:#A6ACCD;">32 </span><span style="color:#F78C6C;">4K</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_comp_level </span><span style="color:#A6ACCD;">6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_min_length </span><span style="color:#A6ACCD;">200</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_types </span><span style="color:#A6ACCD;">text/css  application/x-javascript</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_vary </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^(.*)$</span><span style="color:#F07178;">  /index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">break;</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/youdomain/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-e $</span><span style="color:#A6ACCD;">request_filename)</span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">       </span><span style="color:#89DDFF;">rewrite</span><span style="color:#F07178;">  </span><span style="color:#C3E88D;">^/youdomain/(.*)$</span><span style="color:#F07178;">  /youdomain/index.php?s=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;"> last;</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#设置缓存</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> .*\.(gif|jpg|jpeg|png|bmp|swf)$</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#89DDFF;"> expires </span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">30d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> .*\.(js|css)?$</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#89DDFF;"> expires </span><span style="color:#F07178;">     </span><span style="color:#F78C6C;">1h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="调整-php7-4-配置的一些内容" tabindex="-1">调整 PHP7.4 配置的一些内容 <a class="header-anchor" href="#调整-php7-4-配置的一些内容" aria-hidden="true">#</a></h2><h3 id="pdo-mysql-1" tabindex="-1">pdo_mysql <a class="header-anchor" href="#pdo-mysql-1" aria-hidden="true">#</a></h3><table><thead><tr><th>PDO Driver for MySQL</th><th>enabled</th></tr></thead><tbody><tr><td>Client API version</td><td>mysqlnd 7.4.2</td></tr></tbody></table><table><thead><tr><th>Directive</th><th>Local Value</th><th>Master Value</th></tr></thead><tbody><tr><td>pdo_mysql.default_socket</td><td>/tmp/mysql.sock</td><td>/tmp/mysql.sock</td></tr></tbody></table><p>可以看到它的<code>socket</code>文件是在<code>/tmp/mysql.sock</code>下，我们需要配置以下<code>php.ini</code>里的存储位置</p><p>修改<code>php.ini</code></p><div class="language-ini line-numbers-mode"><button class="copy"></button><span class="lang">ini</span><pre><code><span class="line"><span style="color:#89DDFF;">[Pdo_mysql]</span></span>
<span class="line"><span style="color:#676E95;">; Default socket name for local MySQL connects.  If empty, uses the built-in</span></span>
<span class="line"><span style="color:#676E95;">; MySQL defaults.</span></span>
<span class="line"><span style="color:#F07178;">pdo_mysql.default_socket</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">/usr/local/mysql/tmp/mysql.sock</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后重启<code>php-fpm7</code></p><h2 id="php7-4-安装-swoole-扩展" tabindex="-1">PHP7.4 安装 swoole 扩展 <a class="header-anchor" href="#php7-4-安装-swoole-扩展" aria-hidden="true">#</a></h2><p>这里 swoole 的版本我选的是<code>4.4.15</code>，反正只要是<code>x86</code>架构的 LInux 环境下安装，一般都没啥毛病了。</p><p>还是老样子，下载源码包上传到<code>/usr/local/src</code>目录下并解压</p><p>然后使用<code>phpize</code>打包</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 swoole-4.4.15</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/php7/bin/phpize</span></span>
<span class="line"><span style="color:#A6ACCD;">Configuring for:</span></span>
<span class="line"><span style="color:#A6ACCD;">PHP Api Version:         20190902</span></span>
<span class="line"><span style="color:#A6ACCD;">Zend Module Api No:      20190902</span></span>
<span class="line"><span style="color:#A6ACCD;">Zend Extension Api No:   320190902</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 swoole-4.4.15</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ./configure --enable-openssl --enable-http2 --enable-sockets --enable-mysqlnd --with-php-config=/usr/local/php7/bin/php-config</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就是编译安装</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">make </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> make install</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装完了，我们可以选择<code>make test</code>一下看看。</p><p>然后就是将<code>swoole.so</code>扩展加入到<code>php.ini</code>文件中</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 swoole-4.4.15</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># vim /usr/local/php7/etc/php.ini</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ini line-numbers-mode"><button class="copy"></button><span class="lang">ini</span><pre><code><span class="line"><span style="color:#676E95;"># 我们可与i找到 zip.so 在下面添加一下即可</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">extension</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">swoole.so</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>检测</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 swoole-4.4.15</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/php7/bin/php --ri swoole</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">swoole</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Swoole =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">Author =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Swoole Team </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">team@swoole.com</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">Version =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 4.4.15</span></span>
<span class="line"><span style="color:#A6ACCD;">Built =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Aug 14 2022 18:15:59</span></span>
<span class="line"><span style="color:#A6ACCD;">coroutine =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">epoll =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">eventfd =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">signalfd =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">cpu_affinity =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">spinlock =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">rwlock =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">sockets =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">openssl =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> OpenSSL 1.0.2k-fips  26 Jan 2017</span></span>
<span class="line"><span style="color:#A6ACCD;">http2 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">pcre =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">zlib =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 1.2.7</span></span>
<span class="line"><span style="color:#A6ACCD;">mutex_timedlock =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">pthread_barrier =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">futex =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">mysqlnd =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"><span style="color:#A6ACCD;">async_redis =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> enabled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Directive =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Local Value =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Master Value</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.enable_coroutine =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.enable_library =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.enable_preemptive_scheduler =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Off =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Off</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.display_errors =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.use_shortname =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> On</span></span>
<span class="line"><span style="color:#A6ACCD;">swoole.unixsock_buffer_size =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 8388608 =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 8388608</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="安装-composer" tabindex="-1">安装 composer <a class="header-anchor" href="#安装-composer" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 src</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># curl -sS https://getcomposer.org/installer | /usr/local/php7/bin/php</span></span>
<span class="line"><span style="color:#A6ACCD;">All settings correct </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> using Composer</span></span>
<span class="line"><span style="color:#A6ACCD;">Downloading...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Composer </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">version 2.3.10</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> successfully installed to: /usr/local/src/composer.phar</span></span>
<span class="line"><span style="color:#A6ACCD;">Use it: php composer.phar</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>移动到<code>/usr/local/bin</code>下，并为<code>php7</code>添加软链接</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 src</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># mv composer.phar /usr/local/bin/composer</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 src</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ln -s /usr/local/php7/bin/php /usr/local/bin/php</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置阿里云镜像</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果有安装一些<code>swoole</code>框架，可能会需要开放<code>9501</code>端口或别的端口</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=9501/tcp --permanent</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl restart firewalld.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-f0af2311 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><div class="edit-link" data-v-a54a85bd><a class="VPLink link edit-link-button" href="https://gitee.com/wxvirus/docs/edit/master/docs/deploy/php-compile-install.md" target="_blank" rel="noreferrer" data-v-a54a85bd data-v-3c355974><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" data-v-a54a85bd><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page on Gitee<!--]--><!----></a></div><!----></div><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/docs/deploy/introduction" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>介绍</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/docs/deploy/linux-install-nginx" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>Linux安装配置nginx</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-ca9ccb7e data-v-9f24cc86><div class="container" data-v-9f24cc86><p class="message" data-v-9f24cc86>Released under the MIT License.</p><p class="copyright" data-v-9f24cc86>Copyright © 2022-present Licrone</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"deploy_introduction.md\":\"2eebebae\",\"deploy_linux-install-nginx.md\":\"d94729a9\",\"deploy_php-compile-install.md\":\"2d9a0027\",\"go_concurrent_go-pipe.md\":\"a741caf3\",\"go_concurrent_introduction.md\":\"682479d7\",\"go_func-timeout.md\":\"9c0942bc\",\"go_ginskill_common-error-result.md\":\"b6550709\",\"go_ginskill_common-error.md\":\"eb3b394b\",\"go_ginskill_common-response.md\":\"87af32dd\",\"go_ginskill_model-constructor.md\":\"3359c51a\",\"go_ginskill_ratelimite.md\":\"97312319\",\"go_go-reflect.md\":\"2cf7c52e\",\"go_go-slice.md\":\"6d840282\",\"go_go-some-base.md\":\"ac9a6454\",\"go_interview_go-abstract-factory.md\":\"d5d5dfdd\",\"go_interview_go-chan-dialog.md\":\"63583c3a\",\"go_interview_go-coroutine-dispatch.md\":\"5c472637\",\"go_interview_go-decorator.md\":\"66d432bb\",\"go_interview_go-defer-question.md\":\"ac22d463\",\"go_interview_go-get-file-line.md\":\"2083c387\",\"go_interview_go-io-close-chan.md\":\"3ffa7766\",\"go_interview_go-kv-map-get.md\":\"370a0d5a\",\"go_interview_go-memory-escape.md\":\"4267ef4b\",\"go_interview_go-nil-not-equal.md\":\"c9dd60fe\",\"go_interview_go-prefix-tree.md\":\"d194dd71\",\"go_interview_go-raft.md\":\"2fccad9d\",\"go_interview_go-simple-factory.md\":\"bd1c52ce\",\"go_interview_go-simple-set.md\":\"d46f5603\",\"go_interview_go-singleton.md\":\"301ac829\",\"go_interview_go-sq-copy.md\":\"6715cde0\",\"go_interview_go-struct-compare.md\":\"e7f14e91\",\"go_interview_goroutine-why-last-output.md\":\"42616f41\",\"go_limit-goroutine-run.md\":\"5f8d19a8\",\"go_mac-install-go.md\":\"533a8be9\",\"go_ws_base.md\":\"a40aafcd\",\"go_ws_store-client-obj.md\":\"4dea5f44\",\"index.md\":\"62298313\",\"k8s_cue_base.md\":\"608d6c24\",\"k8s_docker_base-op.md\":\"41db887d\",\"k8s_docker_install.md\":\"c34a4e33\",\"k8s_introduction.md\":\"838d4ae6\",\"k8s_k8s-components.md\":\"9de90c36\",\"k8s_kubernetes_deploy-rancher2-k8s.md\":\"fad56a03\",\"rust_base_cargo-vscode-config.md\":\"289612b4\",\"rust_base_first-rust.md\":\"0b13a81a\",\"rust_base_fn-pass-vari.md\":\"be71815f\",\"rust_base_rust-basetype-vari.md\":\"96fcc0b4\",\"rust_base_rust-expression.md\":\"66fda817\",\"rust_base_rust-fn-module.md\":\"b3edaefb\",\"rust_base_rust-str-exercise.md\":\"6813f223\",\"rust_base_struct-base.md\":\"f34cda0a\",\"rust_base_win-install.md\":\"59ce80f8\",\"rust_introduction.md\":\"0d54a80b\"}")</script>
    <script type="module" async src="/docs/assets/app.15e8eba7.js"></script>
    
  </body>
</html>