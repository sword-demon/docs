import{_ as s,c as n,o as a,d as l}from"./app.15e8eba7.js";const A=JSON.parse('{"title":"Linux \u5B89\u88C5 Nginx \u548C\u914D\u7F6E","description":"","frontmatter":{},"headers":[{"level":2,"title":"Nginx \u5B89\u88C5","slug":"nginx-\u5B89\u88C5"},{"level":3,"title":"gcc \u5B89\u88C5","slug":"gcc-\u5B89\u88C5"},{"level":3,"title":"\u6DFB\u52A0\u4E00\u4E2A nginx \u7528\u6237","slug":"\u6DFB\u52A0\u4E00\u4E2A-nginx-\u7528\u6237"},{"level":3,"title":"\u914D\u7F6E","slug":"\u914D\u7F6E"},{"level":3,"title":"\u914D\u7F6E vhost","slug":"\u914D\u7F6E-vhost"},{"level":2,"title":"nginx \u53C2\u6570\u4F18\u5316","slug":"nginx-\u53C2\u6570\u4F18\u5316"},{"level":3,"title":"\u914D\u7F6E\u4F18\u5316","slug":"\u914D\u7F6E\u4F18\u5316"},{"level":3,"title":"\u6700\u7EC8\u914D\u7F6E\u5185\u5BB9","slug":"\u6700\u7EC8\u914D\u7F6E\u5185\u5BB9"},{"level":2,"title":"\u8D1F\u8F7D\u5747\u8861","slug":"\u8D1F\u8F7D\u5747\u8861"}],"relativePath":"deploy/linux-install-nginx.md","lastUpdated":null}'),p={name:"deploy/linux-install-nginx.md"},e=l(`<h1 id="linux-\u5B89\u88C5-nginx-\u548C\u914D\u7F6E" tabindex="-1">Linux \u5B89\u88C5 Nginx \u548C\u914D\u7F6E <a class="header-anchor" href="#linux-\u5B89\u88C5-nginx-\u548C\u914D\u7F6E" aria-hidden="true">#</a></h1><h2 id="nginx-\u5B89\u88C5" tabindex="-1">Nginx \u5B89\u88C5 <a class="header-anchor" href="#nginx-\u5B89\u88C5" aria-hidden="true">#</a></h2><p>\u4E0B\u8F7D\u5B89\u88C5\u5305\uFF1A\u6211\u8FD9\u91CC\u4F7F\u7528\u7684\u662F\uFF1A<code>nginx-1.17.8.tar.gz</code></p><p>\u4E0B\u8F7D\u5B8C\u4E86\uFF0C\u7136\u540E\u4E0A\u4F20\u5230\u670D\u52A1\u5668\u4E4B\u540E\uFF0C\u6211\u4EEC\u5F97\u4E0B\u8F7D\u4E00\u4E9B\u9700\u8981\u5F97\u4F9D\u8D56\u5305\u3002</p><h3 id="gcc-\u5B89\u88C5" tabindex="-1">gcc \u5B89\u88C5 <a class="header-anchor" href="#gcc-\u5B89\u88C5" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">yum -y install unzip zip  ncurses-devel zlib libxml libjpeg freetype libpng gd curl libiconv zlib-devel libxml2-devel libjpeg-devel freetype-devel libpng-devel gd-devel curl-devel libxslt-devel  zlib-devel openssl-devel gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng-devel  freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl-devel openssl-devel expat expat-devel make gcc g++ gcc-c++ libtool autoconf automake imake mysql-devel libxm2-devel expat-devel  net-snmp-devel  libcurl-deve libevent libevent-devel openldap openldap-devel</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="\u6DFB\u52A0\u4E00\u4E2A-nginx-\u7528\u6237" tabindex="-1">\u6DFB\u52A0\u4E00\u4E2A nginx \u7528\u6237 <a class="header-anchor" href="#\u6DFB\u52A0\u4E00\u4E2A-nginx-\u7528\u6237" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">useradd nginx -s /sbin/nologin</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u914D\u7F6E</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx-1.17.8</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">Configuration summary</span></span>
<span class="line"><span style="color:#A6ACCD;">  + using system PCRE library</span></span>
<span class="line"><span style="color:#A6ACCD;">  + using system OpenSSL library</span></span>
<span class="line"><span style="color:#A6ACCD;">  + using system zlib library</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  nginx path prefix: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx binary file: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/sbin/nginx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx modules path: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/modules</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx configuration prefix: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/conf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx configuration file: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/conf/nginx.conf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx pid file: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/logs/nginx.pid</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx error log file: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/logs/error.log</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http access log file: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/logs/access.log</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http client request body temporary files: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">client_body_temp</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http proxy temporary files: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">proxy_temp</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http fastcgi temporary files: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fastcgi_temp</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http uwsgi temporary files: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">uwsgi_temp</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  nginx http scgi temporary files: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scgi_temp</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u7136\u540E\u8FDB\u884C\u7F16\u8BD1\u5B89\u88C5</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">make </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> make install</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u7F16\u8BD1\u5B89\u88C5\u5B8C\u4E4B\u540E\u6211\u4EEC\u8FDB\u884C\u542F\u52A8\u4E00\u4E0B</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 nginx-1.17.8</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/nginx/sbin/nginx</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7136\u540E\u7ED9<code>nginx</code>\u6DFB\u52A0\u9632\u706B\u5899\u7AEF\u53E3</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">firewall-cmd --zone=public --add-port=80/tcp --permanent</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u518D\u8FDB\u884C\u91CD\u542F\u9632\u706B\u5899</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">systemctl restart firewalld.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/20220813221453.png" alt=""></p><p>\u7136\u540E\u4F7F\u7528\u6211\u4EEC\u865A\u62DF\u673A\u7684<code>ip</code>\u5730\u5740\u5230\u6D4F\u89C8\u5668\u91CC\u53BB\u8BBF\u95EE\uFF0C\u5C31\u53EF\u4EE5\u770B\u5230<code>nginx</code>\u5B89\u88C5\u548C\u542F\u52A8\u6210\u529F\u4E86\u3002</p><h3 id="\u914D\u7F6E" tabindex="-1">\u914D\u7F6E <a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a></h3><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /usr/local/nginx/conf</span></span>
<span class="line"><span style="color:#A6ACCD;">mv nginx.conf nginx_\u5F53\u524D\u65E5\u671F.conf </span><span style="color:#676E95;"># \u5907\u4EFD\u4E00\u4E0B</span></span>
<span class="line"><span style="color:#A6ACCD;">vim nginx.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#charset koi8-r;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  /home/web/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;"> index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;">  /50x.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u5177\u4F53\u4E5F\u6CA1\u6539\u5565\uFF0C\u5C31\u662F\u6539\u4E86\u4E00\u4E2A<code>root</code>\u7684\u6307\u5411\u7684\u76EE\u5F55\u3002</p><p>\u7136\u540E\u8FDB\u884C\u8BED\u6CD5\u68C0\u6D4B\u548C\u914D\u7F6E\u91CD\u8F7D</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 conf</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/nginx/sbin/nginx -t</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: configuration file /usr/local/nginx/conf/nginx.conf </span><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;"> is successful</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 conf</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># /usr/local/nginx/sbin/nginx -s reload</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u7136\u540E\u6211\u4EEC\u521B\u5EFA\u5BF9\u5E94\u7684<code>/home/web</code>\u76EE\u5F55</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /home/web/</span></span>
<span class="line"><span style="color:#676E95;"># \u914D\u7F6Enginx\u6743\u9650</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R nginx.nginx /home/web/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># \u7B80\u5355\u7F16\u5199\u4E00\u4E2A index.html</span></span>
<span class="line"><span style="color:#A6ACCD;">vim /home/web/index.html</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7136\u540E\u67E5\u770B\u6211\u4EEC\u6D4F\u89C8\u5668\u8BBF\u95EE\u7684\u65F6\u5019\uFF0C\u662F\u5426\u53D8\u6210\u4E86\u5BF9\u5E94\u7684\u8F93\u5165\u7684<code>index.html</code>\u7684\u5185\u5BB9\u5373\u53EF\u3002</p><p><strong>\u914D\u7F6E\u5F00\u542F\u81EA\u542F</strong></p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /etc/init.d/</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6211\u4EEC\u7F16\u5199\u4E00\u4E2A\u811A\u672C\u6587\u4EF6\u540D\u79F0\u4E3A<code>nginx</code>\u4E0D\u5E26\u4EFB\u4F55\u540E\u7F00</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;">#!/bin/bash</span></span>
<span class="line"><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#676E95;"># Startup script for Nginx - this script starts and stops the nginx daemon</span></span>
<span class="line"><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#676E95;"># chkconfig:   - 85 15</span></span>
<span class="line"><span style="color:#676E95;"># description:  Nginx is an HTTP(S) server, HTTP(S) reverse proxy and IMAP/POP3 proxy server</span></span>
<span class="line"><span style="color:#676E95;"># processname: nginx</span></span>
<span class="line"><span style="color:#676E95;"># config:      /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">pidfile=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/logs/nginx.pid</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Source function library.</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> /etc/rc.d/init.d/functions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Source networking configuration.</span></span>
<span class="line"><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> /etc/sysconfig/network</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># Check that networking is up.</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">NETWORKING</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">no</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">nginx=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/sbin/nginx</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">prog=</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">basename </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">nginx</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">NGINX_CONF_FILE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/usr/local/nginx/conf/nginx.conf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-f</span><span style="color:#A6ACCD;"> /etc/sysconfig/nginx </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> /etc/sysconfig/nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">lockfile=/var/lock/subsys/nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-x</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">nginx </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 5</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">NGINX_CONF_FILE </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 6</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> -n </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Starting </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">prog</span><span style="color:#C3E88D;">: </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    daemon </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">nginx -c </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">NGINX_CONF_FILE</span></span>
<span class="line"><span style="color:#A6ACCD;">    retval=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">retval </span><span style="color:#89DDFF;">-eq</span><span style="color:#A6ACCD;"> 0 </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> touch </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">lockfile</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">retval</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">stop</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> -n </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Stopping </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">prog</span><span style="color:#C3E88D;">: </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    killproc </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">prog -QUIT</span></span>
<span class="line"><span style="color:#A6ACCD;">    retval=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">retval </span><span style="color:#89DDFF;">-eq</span><span style="color:#A6ACCD;"> 0 </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> rm -f </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">lockfile</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">retval</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">restart</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    configtest </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">    stop</span></span>
<span class="line"><span style="color:#A6ACCD;">    sleep 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    start</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">reload</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    configtest </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> -n </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Reloading </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">prog</span><span style="color:#C3E88D;">: </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    killproc </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">nginx -HUP</span></span>
<span class="line"><span style="color:#A6ACCD;">    RETVAL=</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">?</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">force_reload</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    restart</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">configtest</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">nginx -t -c </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">NGINX_CONF_FILE</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">rh_status</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    status </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">prog</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">rh_status_q</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    rh_status </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">case</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span></span>
<span class="line"><span style="color:#A6ACCD;">    start</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        rh_status_q </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    stop</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        rh_status_q </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    restart</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">configtest</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    reload</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        rh_status_q </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 7</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    force-reload</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        force_reload</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    status</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        rh_status</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    condrestart</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">try-restart</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        rh_status_q </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">*)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Usage: </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">0</span><span style="color:#C3E88D;"> {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 2</span></span>
<span class="line"><span style="color:#89DDFF;">esac</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br></div></div><p>\u7F16\u5199\u5B8C\u6BD5\u4E4B\u540E\u4E0A\u4F20\u5230\u521A\u624D\u7684\u76EE\u5F55\u4E2D\uFF0C\u5E76\u4E14\u8BBE\u7F6E\u4E00\u4E9B\u6743\u9650</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">chmod a+x nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u518D\u8FDB\u884C\u4F7F\u7528\u547D\u4EE4</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">service nginx restart</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u5982\u679C\u9047\u5230\u4EC0\u4E48<code>can not open directory\u56E0\u4E3Anginx.pid\u6CA1\u4E86</code></p><p>\u6211\u4EEC\u5C31\u5728\u4E0A\u8FF0\u7684<code>nginx</code>\u91CC\u914D\u7F6E\u4E00\u4E2A</p><p><code>pidfile=&quot;/usr/local/nginx/logs/nginx.pid&quot;</code>\u8FD9\u4E00\u884C\uFF0C\u8BBE\u7F6E\u4F60\u7684<code>nginx.pid</code>\u6587\u4EF6\u4F4D\u7F6E\u5373\u53EF\uFF0C\u4E00\u822C\u7ED9\u7684\u8FD9\u91CC\u662F\u6CE8\u91CA\u6389\u7684\u3002</p><p>\u7136\u540E\u4F7F\u7528<code>chkconfig</code>\u547D\u4EE4\u52A0\u5165\u5F00\u673A\u542F\u52A8</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">chkconfig nginx on</span></span>
<span class="line"><span style="color:#A6ACCD;">chkconfig nginx --list</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u53EA\u8981\u770B\u5230 3\uFF0C4\uFF0C5 \u662F\u5F00\u7684\u5373<code>on</code>\u72B6\u6001\u5373\u53EF</p><h3 id="\u914D\u7F6E-vhost" tabindex="-1">\u914D\u7F6E vhost <a class="header-anchor" href="#\u914D\u7F6E-vhost" aria-hidden="true">#</a></h3><p>\u8FDB\u5165<code>nginx</code>\u7684\u914D\u7F6E\u6587\u4EF6\u76EE\u5F55\uFF0C\u65B0\u5EFA\u4E00\u4E2A<code>vhost</code>\u76EE\u5F55\uFF0C\u91CC\u9762\u4EE5\u540E\u5B58\u653E\u522B\u7684\u4E00\u4E9B\u7AD9\u70B9\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u7136\u540E\u4E3B\u8981\u7684<code>nginx.conf</code>\u8FD8\u5F97\u5305\u542B\u4E00\u4E0B</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim nginx.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u5728\u6700\u4E0B\u9762\u4E00\u884C\u6DFB\u52A0</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">vhost/*.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u7136\u540E\u6211\u4EEC\u5728<code>vhost</code>\u76EE\u5F55\u4E0B\u65B0\u5EFA\u4E00\u4E2A\u7B80\u5355\u7684\u7AD9\u70B9\u914D\u7F6E\u6587\u4EF6\u8FDB\u884C\u6D4B\u8BD5</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># \u76D1\u542C\u7AEF\u53E3\u53F7</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># \u57DF\u540D</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;">www.php7.tt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># \u7F51\u7AD9\u76EE\u5F55</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/home/web/php7/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/</span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssi </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> ssi_silent_errors </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.php index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_access.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>\u6211\u4EEC\u914D\u7F6E\u7684\u662F<code>www.php7.tt</code>\u7F51\u5740\uFF0C\u6240\u4EE5\u6211\u4EEC\u5FC5\u987B\u5728\u672C\u673A\u4E0A\u8FDB\u884C<code>hosts</code>\u8BBE\u7F6E\u624D\u80FD\u8FDB\u884C\u8BBF\u95EE\u3002</p><p>\u7136\u540E\u914D\u7F6E\u5B8C\u4E86\uFF0C\u6211\u4EEC\u521B\u5EFA\u4E00\u4E2A\u5BF9\u5E94\u7684\u5B58\u653E\u76EE\u5F55</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /home/web/php7</span></span>
<span class="line"><span style="color:#A6ACCD;">vim /home/web/php7/index.html</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5355\u5199\u4E00\u70B9\u5185\u5BB9\uFF0C\u7136\u540E\u91CD\u542F<code>nginx</code>\u5728\u672C\u5730\u6D4F\u89C8\u5668\u8FDB\u884C\u67E5\u770B\u5185\u5BB9\u5373\u53EF</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">192.168.33.10 www.php7.tt</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>hosts</code>\u6587\u4EF6\u91CC\u5F97\u914D\u7F6E\u4E0A\u4F60\u5BF9\u5E94\u5F97\u865A\u62DF\u673A\u7684<code>ip</code></p><h2 id="nginx-\u53C2\u6570\u4F18\u5316" tabindex="-1">nginx \u53C2\u6570\u4F18\u5316 <a class="header-anchor" href="#nginx-\u53C2\u6570\u4F18\u5316" aria-hidden="true">#</a></h2><ol><li><p>\u5F00\u542F<code>gzip</code>\u538B\u7F29 \u5F00\u542F\u6807\u5FD7</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u6587\u4EF6\u5927\u5C0F\u672A\u8FBE\u5230\u8BE5\u503C\uFF0C\u4E0D\u538B\u7F29\uFF0C\u6587\u4EF6\u5DF2\u8FBE\u5230\u8BE5\u503C\uFF0C\u538B\u7F29</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_min_length </span><span style="color:#A6ACCD;">1k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u8BBE\u7F6E<code>gzip</code>\u538B\u7F29\u6587\u4EF6\u4F7F\u7528\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F</p><ul><li><p><code>number</code>: \u5411\u7CFB\u7EDF\u7533\u8BF7\u6362\u79DF\u7A7A\u95F4\u7684\u4E2A\u6570</p></li><li><p><code>size</code>: \u6307\u5B9A\u6BCF\u4E2A\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F\uFF0C\u4E00\u822C\u53D6\u7CFB\u7EDF\u5185\u5B58\u9875\u4E00\u9875\u7684\u5927\u5C0F</p></li></ul><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_buffers </span><span style="color:#A6ACCD;">4 </span><span style="color:#F78C6C;">16k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_http_version </span><span style="color:#A6ACCD;">1.0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u7528\u4E8E\u538B\u7F29\u54CD\u5E94\u6240\u9700\u8981\u7684\u6700\u5C0F<code>http</code>\u534F\u8BAE\u7248\u672C\u3002\u6CE8\u610F\u53C2\u6570\u503C\uFF1A<code>1.0 | 1.1</code>\uFF0C\u6B64\u5904\u53EA\u80FD\u662F<code>1.0</code>\u6216\u8005<code>1.1</code></p><p>\u8BBE\u7F6E\u538B\u7F29<code>gzip</code>\u538B\u7F29\u7A0B\u5EA6\uFF0C\u5305\u62EC 1~9 \u53CA\uFF0C1 \u6700\u4F4E\uFF0C9 \u6700\u9AD8\uFF0C\u9ED8\u8BA4\u4E3A 1</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_com_level</span><span style="color:#A6ACCD;"> 2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u53C2\u6570\u503C\uFF1A\u54CD\u5E94\u62A5\u6587\u6570\u636E\u683C\u5F0F\uFF0C\u6216\u8005\u8BF4\u7C7B\u578B\uFF0C\u5BF9\u5E94<code>http</code>\u54CD\u5E94\u5934\u4E2D\u7684<code>Content-type</code>\u5B57\u6BB5\uFF0C\u5982\u5E38\u89C1\u7684\u6709<code>text/html</code>\u3001<code>text/css</code>\u3001<code>application/json</code>\u3001<code>application/javaScript</code>\u7B49\u3002\u7528\u4E8E\u6307\u5B9A\u8981\u538B\u7F29\u7684\u54CD\u5E94\u62A5\u6587\u7C7B\u578B\u3002\u201D *\u201D\u8868\u793A\u538B\u7F29\u6240\u6709\u683C\u5F0F\u7684\u54CD\u5E94\u62A5\u6587\uFF0C\u591A\u79CD\u683C\u5F0F\u7528\u7A7A\u683C\u9694\u5F00\u3002\u5982<code>text/html text/css</code>\u3002\u9ED8\u8BA4\u503C\uFF1Atext/html</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_types </span><span style="color:#A6ACCD;">      text/plain application/x-javascript text/css application/xml</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u7528\u4E8E\u8BBE\u7F6E\u5728\u8FDB\u884C gzip \u538B\u7F29\u65F6\u662F\u5426\u53D1\u9001\u5E26\u6709 Vary:Accept-Encoding \u5934\u57DF\u7684\u54CD\u5E94\u5934\u90E8</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_vary </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u6839\u636E\u4E0D\u540C\u7684\u5BA2\u6237\u7AEF\u8BF7\u6C42\u9009\u62E9\u6027\u7684\u5F00\u542F\u6216\u5173\u95ED gzip \u6307\u4EE4 gzip_disable MSIE [4-6]. \u5BF9 IE4-6 \u4E0D\u5F00\u542F gzip \u538B\u7F29</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">gzip_disable </span><span style="color:#A6ACCD;">msie6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>\u914D\u7F6E\u65E5\u5FD7\u683C\u5F0F</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">log_format </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p><code>$remote_addr</code> \u5BA2\u6237\u7AEF\u5730\u5740 219.227.111.255</p></li><li><p><code>$remote_user</code> \u5BA2\u6237\u7AEF\u7528\u6237\u540D\u79F0 \u2014</p></li><li><p><code>$time_local</code> \u8BBF\u95EE\u65F6\u95F4\u548C\u65F6\u533A 18/Jul/2014:17:00:01 +0800</p></li><li><p><code>$request</code> \u8BF7\u6C42\u7684 URI \u548C HTTP \u534F\u8BAE \u201CGET /article-10000.html HTTP/1.1\u201D</p></li><li><p><code>$http_host</code> \u8BF7\u6C42\u5730\u5740\uFF0C\u5373\u6D4F\u89C8\u5668\u4E2D\u4F60\u8F93\u5165\u7684\u5730\u5740\uFF08IP \u6216\u57DF\u540D\uFF09 <a href="http://www.ha97.com" title="www.ha97.com" target="_blank" rel="noreferrer">www.ha97.com</a></p></li><li><p><code>$status</code> HTTP \u8BF7\u6C42\u72B6\u6001 200</p></li><li><p><code>$upstream_status</code> upstream \u72B6\u6001 200</p></li><li><p><code>$body_bytes_sent</code> \u53D1\u9001\u7ED9\u5BA2\u6237\u7AEF\u6587\u4EF6\u5185\u5BB9\u5927\u5C0F 1547</p></li><li><p><code>$http_referer</code> url \u8DF3\u8F6C\u6765\u6E90 <a href="https://www.google.com/" title="https://www.google.com/" target="_blank" rel="noreferrer">https://www.google.com/</a></p></li><li><p><code>$http_user_agent</code> \u7528\u6237\u7EC8\u7AEF\u6D4F\u89C8\u5668\u7B49\u4FE1\u606F \u201CMozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; SV1; GTB7.0; .NET4.0C;</p></li><li><p><code>$ssl_protocol</code> SSL \u534F\u8BAE\u7248\u672C TLSv1</p></li><li><p><code>$ssl_cipher</code> \u4EA4\u6362\u6570\u636E\u4E2D\u7684\u7B97\u6CD5 RC4-SHA</p></li><li><p><code>$upstream_addr</code> \u540E\u53F0 upstream \u7684\u5730\u5740\uFF0C\u5373\u771F\u6B63\u63D0\u4F9B\u670D\u52A1\u7684\u4E3B\u673A\u5730\u5740 10.36.10.80:80</p></li><li><p><code>$request_time</code> \u6574\u4E2A\u8BF7\u6C42\u7684\u603B\u65F6\u95F4 0.165</p></li><li><p><code>$upstream_response_time</code> \u8BF7\u6C42\u8FC7\u7A0B\u4E2D\uFF0Cupstream \u54CD\u5E94\u65F6\u95F4 0.002</p></li><li><p><code>$remote_addr</code> \u4E0E<code>$http_x_forwarded_for</code> \u7528\u4EE5\u8BB0\u5F55\u5BA2\u6237\u7AEF\u7684 ip \u5730\u5740</p><blockquote><p>112.31.97.44 - - [08/Dec/2019:11:36:07 +0800] &quot;GET /goods/1.html HTTP/1.1&quot; 200 9898 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36&quot;</p></blockquote></li></ul></li><li><p>\u53C2\u6570\u8C03\u4F18</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">user\u662F\u4E3B\u6A21\u5757\u6307\u4EE4\uFF0C\u5B9A\u4E49Nginx\u8FD0\u884C\u7684\u7528\u6237\u548C\u7528\u6237\u7EC4</span></span>
<span class="line"><span style="color:#A6ACCD;">    user nginx nginx;</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u5DE5\u4F5C\u8FDB\u7A0B\u6570 \u8BBE\u7F6E\u4E3A\u81EA\u52A8</span></span>
<span class="line"><span style="color:#A6ACCD;">    worker_processes auto;</span></span>
<span class="line"><span style="color:#A6ACCD;">    nginx\u9ED8\u8BA4\u662F\u6CA1\u6709\u5F00\u542F\u5229\u7528\u591A\u6838cpu\u7684\u914D\u7F6E\u7684\u3002\u9700\u8981\u901A\u8FC7\u589E\u52A0worker_cpu_affinity\u914D\u7F6E\u53C2\u6570\u6765\u5145\u5206\u5229\u7528\u591A\u6838cpu\uFF0Ccpu\u662F\u4EFB\u52A1\u5904\u7406\uFF0C\u5F53\u8BA1\u7B97\u6700\u8D39\u65F6\u7684\u8D44\u6E90\u7684\u65F6\u5019\uFF0Ccpu\u6838\u4F7F\u7528\u4E0A\u7684\u8D8A\u591A\uFF0C\u6027\u80FD\u5C31\u8D8A\u597D</span></span>
<span class="line"><span style="color:#A6ACCD;">    worker_cpu_affinity 0001 0100 1000 0010;</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u5355\u4E2A\u5DE5\u4F5C\u8FDB\u7A0B\u53EF\u4EE5\u5141\u8BB8\u540C\u65F6\u5EFA\u7ACB\u5916\u90E8\u8FDE\u63A5\u7684\u6570\u91CF \u4E00\u662F\u5185\u5B58\uFF0C\u4E8C\u662F\u64CD\u4F5C\u7CFB\u7EDF\u7EA7\u8FDB\u7A0B\u6700\u5927\u53EF\u6253\u5F00\u6587\u4EF6\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    worker_connections  65535;</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u8FDB\u7A0B\u6700\u5927\u53EF\u6253\u5F00\u6587\u4EF6\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    worker_rlimit_nofile 65535;</span></span>
<span class="line"><span style="color:#A6ACCD;">  events {</span></span>
<span class="line"><span style="color:#A6ACCD;">      worker_connections 65535;</span></span>
<span class="line"><span style="color:#A6ACCD;">      \u6027\u80FD\u4F18\u5316-nginx\u4E8B\u4EF6\u5904\u7406\u6A21\u578B\u4F18\u5316use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;">      use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;">      \u7F51\u7EDC\u8FDE\u63A5\u7684\u4F18\u5316\u540C\u4E00\u65F6\u523B\u53EA\u6709\u4E00\u4E2A\u8BF7\u6C42\u800C\u907F\u514D\u591A\u4E2A\u7761\u7720\u8FDB\u7A0B\u88AB\u5524\u9192\u7684\u8BBE\u7F6E\uFF0Con\u4E3A\u9632\u6B62\u88AB\u540C\u65F6\u5524\u9192\uFF0C\u9ED8\u8BA4\u4E3Aoff\uFF0C\u56E0\u6B64nginx\u521A\u5B89\u88C5\u5B8C\u4EE5\u540E\u8981\u8FDB\u884C\u9002\u5F53\u7684\u4F18\u5316\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">      accept_mutex on;</span></span>
<span class="line"><span style="color:#A6ACCD;">      \u6253\u5F00\u540C\u65F6\u63A5\u53D7\u591A\u4E2A\u65B0\u7F51\u7EDC\u8FDE\u63A5\u8BF7\u6C42\u7684\u529F\u80FD\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">    multi_accept on;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  \u8BBE\u7F6Eulimits\uFF1Aulimit -SHn 65535</span></span>
<span class="line"><span style="color:#A6ACCD;">  #\u670D\u52A1\u5668\u540D\u5B57\u7684hash\u8868\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">  server_names_hash_bucket_size 128;</span></span>
<span class="line"><span style="color:#A6ACCD;">  #\u7528\u4E8E\u6307\u5B9A\u6765\u81EA\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5934headerbuffer\u5927\u5C0F\uFF0C\u5BF9\u4E8E\u5927\u591A\u6570\u8BF7\u6C42\uFF0C1KB\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u5DF2\u7ECF\u8DB3\u591F\uFF0C\u5982\u679C\u81EA\u5B9A\u4E49\u4E86\u6D88\u606F\u5934\u6216\u6709\u66F4\u5927\u7684cookie\uFF0C\u53EF\u4EE5\u589E\u52A0\u7F13\u51B2\u533A\u5927\u5C0F\u3002\u8FD9\u91CC\u8BBE\u7F6E\u4E3A32KB</span></span>
<span class="line"><span style="color:#A6ACCD;">  client_header_buffer_size 32k;</span></span>
<span class="line"><span style="color:#A6ACCD;">  #\u7528\u6765\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BF7\u6C42\u4E2D\u8F83\u5927\u7684\u6D88\u606F\u5934\u7684\u7F13\u5B58\u6700\u5927\u6570\u91CF\u548C\u5927\u5C0F\uFF0C\u201C4\u201D\u4E3A\u4E2A\u6570\uFF0C\u201C128\u201D\u4E3A\u5927\u5C0F\uFF0C\u6700\u5927\u7F13\u5B58\u4E3A4\u4E2A128KB\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">  large_client_header_buffers 4 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;">  #\u5141\u8BB8\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5355\u6587\u4EF6\u5B57\u8282\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">  client_max_body_size 10m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     \u5B83\u53EF\u4EE5\u914D\u7F6E\u4E00\u6B21\u53D1\u9001\u6570\u636E\u7684\u5305\u5927\u5C0F\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5B83\u4E0D\u662F\u6309\u65F6\u95F4\u7D2F\u8BA1  0.2 \u79D2\u540E\u53D1\u9001\u5305\uFF0C\u800C\u662F\u5F53\u5305\u7D2F\u8BA1\u5230\u4E00\u5B9A\u5927\u5C0F\u540E\u5C31\u53D1\u9001 \u5728 nginx \u4E2D\uFF0Ctcp_nopush \u5FC5\u987B\u548C sendfile \u642D\u914D\u4F7F\u7528\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">    tcp_nopush     on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u53C2\u6570\u662F\u4E00\u4E2A\u8BF7\u6C42\u5B8C\u6210\u4E4B\u540E\u8FD8\u8981\u4FDD\u6301\u8FDE\u63A5\u591A\u4E45\uFF0C\u4E0D\u662F\u8BF7\u6C42\u65F6\u95F4\u591A\u4E45\uFF0C\u76EE\u7684\u662F\u4FDD\u6301\u957F\u8FDE\u63A5\uFF0C\u51CF\u5C11\u521B\u5EFA\u8FDE\u63A5\u8FC7\u7A0B\u7ED9\u7CFB\u7EDF\u5E26\u6765\u7684\u6027\u80FD\u635F\u8017\uFF0C\u7C7B\u4F3C\u4E8E\u7EBF\u7A0B\u6C60\uFF0C\u6570\u636E\u5E93\u8FDE\u63A5\u6C60</span></span>
<span class="line"><span style="color:#A6ACCD;">    keepalive_timeout  15;</span></span>
<span class="line"><span style="color:#A6ACCD;">    on \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u6570\u636E\u5C0F\u5305\u7684\u6570\u91CF\uFF0C\u4F46\u662F\u53EF\u4EE5\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6\u3002\u5728\u53CA\u65F6\u6027\u9AD8\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#A6ACCD;">    off \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u901A\u4FE1\u7684\u5EF6\u65F6\uFF0C\u4F46\u662F\u4F1A\u63D0\u9AD8\u5E26\u5BBD\u5229\u7528\u7387\u3002\u5728\u9AD8\u5EF6\u65F6\u3001\u6570\u636E\u91CF\u5927\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#A6ACCD;">    tcp_nodelay on;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    Nginx--&gt;\u8FDB\u9636--&gt;\u539F\u7406--&gt;Nginx+php+fastcgi\u7684\u539F\u7406\u4E0E\u5173\u7CFB  https://www.cnblogs.com/mangguoxiansheng/p/5967745.html</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi\u4F18\u5316\u6027\u80FD\u8C03\u4F18 http \u5C42\u52A0\u4E0Afastcgi\u53C2\u6570\u5982\u4E0B\uFF1A</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u8FDE\u63A5\u5230\u540E\u7AEFfastcgi\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_connect_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u5411fastcgi\u8BF7\u6C42\u8D85\u65F6\u65F6\u95F4(\u8FD9\u4E2A\u6307\u5B9A\u503C\u5DF2\u7ECF\u5B8C\u6210\u4E24\u6B21\u63E1\u624B\u540E\u5411fastcgi\u4F20\u9001\u8BF7\u6C42\u7684\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_send_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u63A5\u6536fastcgi\u5E94\u7B54\u8D85\u65F6\u65F6\u95F4\uFF0C\u540C\u7406\u4E5F\u662F2\u6B21\u63E1\u624B\u540E</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_read_timeout 300;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u8BFB\u53D6fastcgi\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206\u9700\u8981\u591A\u5927\u7F13\u51B2\u533A\uFF0C\u8BE5\u503C\u8868\u793A\u4F7F\u75281\u4E2A64kb\u7684\u7F13\u51B2\u533A\u8BFB\u53D6\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206(\u5E94\u7B54\u5934),\u53EF\u4EE5\u8BBE\u7F6E\u4E3Afastcgi_buffers\u9009\u9879\u7F13\u51B2\u533A\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_buffer_size 64k;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u6307\u5B9A\u672C\u5730\u9700\u8981\u591A\u5C11\u548C\u591A\u5927\u7684\u7F13\u51B2\u533A\u6765\u7F13\u51B2fastcgi\u5E94\u7B54\u8BF7\u6C42\uFF0C\u5047\u8BBE\u4E00\u4E2Aphp\u6216java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E3A256kb,\u90A3\u4E48\u4F1A\u4E3A\u5176\u5206\u914D4\u4E2A64kb\u7684\u7F13\u51B2\u6765\u7F13\u5B58\uFF1B\u82E5\u9875\u9762\u5927\u4E8E256kb,\u90A3\u4E48\u5927\u4E8E\u7684256kb\u7684\u90E8\u5206\u4F1A\u7F13\u5B58\u5230fastcgi_temp\u6307\u5B9A\u8DEF\u5F84\u4E2D\uFF0C\u8FD9\u5E76\u975E\u662F\u4E2A\u597D\u529E\u6CD5\uFF0C\u5185\u5B58\u6570\u636E\u5904\u7406\u5FEB\u4E8E\u786C\u76D8\uFF0C\u4E00\u822C\u8BE5\u503C\u5E94\u8BE5\u4E3A\u7AD9\u70B9\u4E2Dphp/java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E2D\u95F4\u503C\uFF0C\u5982\u679C\u7AD9\u70B9\u5927\u90E8\u5206\u811A\u672C\u6240\u4EA7\u751F\u7684\u9875\u9762\u5927\u5C0F\u4E3A256kb\uFF0C\u90A3\u4E48\u53EF\u628A\u503C\u8BBE\u7F6E\u4E3A16 16k,4 64k\u7B49</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_buffers 4 64k;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_busy_buffers_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u5199\u5165\u7F13\u5B58\u6587\u4EF6\u4F7F\u7528\u591A\u5927\u7684\u6570\u636E\u5757\uFF0C\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_temp_file_write_size 128k;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u7F13\u5B58\u8DEF\u5F84\u6587\u4EF6\uFF0C\u76EE\u5F55\u7ED3\u6784\u7B49\u7EA7\uFF0C\u5173\u952E\u5B57\u533A\u57DF\u5B9E\u9645\u548C\u975E\u6D3B\u52A8\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_path  /usr/local/nginx/fastcgi_cache levels=1:2 keys_zone=TEST:10m inactive=5m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u7F13\u5B58\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_key &quot;$request_method://$host$request_uri&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u8BE5\u6307\u4EE4\u7528\u4E8E\u8BBE\u7F6E\u7F13\u5B58\u54EA\u4E9BHTTP\u65B9\u6CD5\uFF0C\u9ED8\u8BA4\u7F13\u5B58HTTP GET/HEAD\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_methods GET HEAD;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u5F00\u542Ffastcgi\u7F13\u5B58\u5E76\u4E3A\u5176\u6307\u5B9A\u4E3ATEST\u540D\u79F0\uFF0C\u964D\u4F4Ecpu\u8D1F\u8F7D,\u9632\u6B62502\u9519\u8BEF\u53D1\u751F.</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache TEST;</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u5E94\u7B54\u4EE3\u7801\u7F13\u5B58\u65F6\u95F4\uFF0C200\u548C302\u5E94\u7B54\u7F13\u5B58\u4E3A1\u4E2A\u5C0F\u65F6\uFF0C301\u4E00\u5929,\u5176\u4ED61\u5206\u949F</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_valid 200 302 1h;</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_valid 301 1d;</span></span>
<span class="line"><span style="color:#A6ACCD;">    fastcgi_cache_valid any 1m;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div></li><li><p>\u9690\u85CF<code>nginx</code>\u7248\u672C\u53F7 \u5728<code>http</code>\u6A21\u5757\u4E2D\u914D\u7F6E</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">server_tokens </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol><h3 id="\u914D\u7F6E\u4F18\u5316" tabindex="-1">\u914D\u7F6E\u4F18\u5316 <a class="header-anchor" href="#\u914D\u7F6E\u4F18\u5316" aria-hidden="true">#</a></h3><p><code>nginx.conf</code></p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#1.\u5F00\u542Fgzip\u538B\u7F29</span></span>
<span class="line"><span style="color:#676E95;">#\u5F00\u542F\u6807\u5FD7</span></span>
<span class="line"><span style="color:#89DDFF;">gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u6587\u4EF6\u5927\u5C0F\u672A\u8FBE\u5230\u8BE5\u503C\uFF0C\u4E0D\u538B\u7F29 \u6587\u4EF6\u5DF2\u8FBE\u5230\u8BE5\u503C\uFF0C\u538B\u7F29</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_min_length </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u7528\u4E8E\u8BBE\u7F6EGzip\u538B\u7F29\u6587\u4EF6\u4F7F\u7528\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F number:\u5411\u7CFB\u7EDF\u7533\u8BF7\u6362\u7C97\u7A7A\u95F4\u7684\u4E2A\u6570\uFF0Csize\uFF1A\u6307\u5B9A\u6BCF\u4E2A\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F\uFF0C\u4E00\u822C\u53D6\u7CFB\u7EDF\u5185\u5B58\u9875\u4E00\u9875\u7684\u5927\u5C0F</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_buffers </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u53C2\u6570\u503C\uFF1A1.0 | 1.1\uFF0C\u6CE8\u610F\uFF0C\u6B64\u5904\u53EA\u80FD\u662F1.0\uFF0C\u6216\u80051.1\u3002\u8BBE\u7F6E\u538B\u7F29\u54CD\u5E94\u6240\u9700\u7684\u6700\u5C0Fhttp\u534F\u8BAE\u7248\u672C</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_http_version </span><span style="color:#A6ACCD;">1.0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u8BBE\u7F6Egzip\u538B\u7F29\u7A0B\u5EA6\uFF0C\u5305\u62EC1~9\u7EA7\u522B\uFF0C1\u6700\u4F4E\uFF0C9\u6700\u9AD8\uFF0C\u9ED8\u8BA4\u4E3A1</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_comp_level </span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u53C2\u6570\u503C\uFF1A\u54CD\u5E94\u62A5\u6587\u6570\u636E\u683C\u5F0F\uFF0C\u6216\u8005\u8BF4\u7C7B\u578B\uFF0C\u5BF9\u5E94http\u54CD\u5E94\u5934\u4E2D\u7684Content-type\u5B57\u6BB5\uFF0C\u5982\u5E38\u89C1\u7684\u6709text/html\u3001text/css\u3001application/json\u3001application/javaScript\u7B49\u3002\u7528\u4E8E\u6307\u5B9A\u8981\u538B\u7F29\u7684\u54CD\u5E94\u62A5\u6587\u7C7B\u578B\u3002\u201D*\u201D\u8868\u793A\u538B\u7F29\u6240\u6709\u683C\u5F0F\u7684\u54CD\u5E94\u62A5\u6587\uFF0C\u591A\u79CD\u683C\u5F0F\u7528\u7A7A\u683C\u9694\u5F00\u3002\u5982text/html text/css\u3002\u9ED8\u8BA4\u503C\uFF1Atext/html</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_types </span><span style="color:#A6ACCD;">      text/plain application/x-javascript text/css application/xml</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u7528\u4E8E\u8BBE\u7F6E\u5728\u8FDB\u884Cgzip\u538B\u7F29\u65F6\u662F\u5426\u53D1\u9001\u5E26\u6709Vary:Accept-Encoding\u5934\u57DF\u7684\u54CD\u5E94\u5934\u90E8\uFF1Bgzip_vary on | off</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_vary </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u6839\u636E\u4E0D\u540C\u7684\u5BA2\u6237\u7AEF\u8BF7\u6C42\u9009\u62E9\u6027\u7684\u5F00\u542F\u6216\u5173\u95EDgzip\u6307\u4EE4gzip_disable MSIE [4-6]\\. \u5BF9IE4-6\u4E0D\u5F00\u542Fgzip\u538B\u7F29</span></span>
<span class="line"><span style="color:#89DDFF;">gzip_disable </span><span style="color:#A6ACCD;">msie6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">include </span><span style="color:#A6ACCD;">vhost/*.conf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u6211\u4EEC\u5728<code>include vhost/*.conf;</code>\u8FD9\u4E00\u884C\u4E0A\u9762\u6DFB\u52A0\u4E0A\u8FF0\u4F18\u5316\u914D\u7F6E\u7136\u540E\u8FDB\u884C<code>nginx -t</code>\u68C0\u6D4B</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 sbin</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># ./nginx -t</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: configuration file /usr/local/nginx/conf/nginx.conf </span><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;"> is successful</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u67E5\u770B<code>nginx</code>\u65E5\u5FD7</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 logs</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># tail -F access.log</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:08:32:16 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 200 612 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:08:32:16 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET /favicon.ico HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 404 555 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://192.168.33.10/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:08:39:50 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 200 14 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:08:48:42 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 304 0 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:10:02:27 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 304 0 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:11:00:08 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 304 0 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">192.168.33.1 - - </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">13/Aug/2022:11:00:14 +0000</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET / HTTP/1.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> 304 0 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.81 Safari/537.36 Edg/104.0.1293.47</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u6DFB\u52A0\u65E5\u5FD7\u8BB0\u5F55\u914D\u7F6E</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># nginx\u65E5\u5FD7\u8BB0\u5F55\u683C\u5F0F</span></span>
<span class="line"><span style="color:#89DDFF;">log_format </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u7136\u540E\u5728<code>nginx.conf</code>\u5934\u90E8\u5206\u66FF\u6362\u539F\u5148\u7684\u5185\u5BB9</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#user\u662F\u4E3B\u6A21\u5757\u6307\u4EE4\uFF0C\u5B9A\u4E49Nginx\u8FD0\u884C\u7684\u7528\u6237\u548C\u7528\u6237\u7EC4</span></span>
<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">nginx nginx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5DE5\u4F5C\u8FDB\u7A0B\u6570 \u8BBE\u7F6E\u4E3A\u81EA\u52A8</span></span>
<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">auto</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#nginx\u9ED8\u8BA4\u662F\u6CA1\u6709\u5F00\u542F\u5229\u7528\u591A\u6838cpu\u7684\u914D\u7F6E\u7684\u3002\u9700\u8981\u901A\u8FC7\u589E\u52A0worker_cpu_affinity\u914D\u7F6E\u53C2\u6570\u6765\u5145\u5206\u5229\u7528\u591A\u6838cpu\uFF0Ccpu\u662F\u4EFB\u52A1\u5904\u7406\uFF0C\u5F53\u8BA1\u7B97\u6700\u8D39\u65F6\u7684\u8D44\u6E90\u7684\u65F6\u5019\uFF0Ccpu\u6838\u4F7F\u7528\u4E0A\u7684\u8D8A\u591A\uFF0C\u6027\u80FD\u5C31\u8D8A\u597D</span></span>
<span class="line"><span style="color:#89DDFF;">worker_cpu_affinity </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u8FDB\u7A0B\u6700\u5927\u53EF\u6253\u5F00\u6587\u4EF6\u6570</span></span>
<span class="line"><span style="color:#89DDFF;">worker_rlimit_nofile </span><span style="color:#A6ACCD;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5355\u4E2A\u5DE5\u4F5C\u8FDB\u7A0B\u53EF\u4EE5\u5141\u8BB8\u540C\u65F6\u5EFA\u7ACB\u5916\u90E8\u8FDE\u63A5\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#A6ACCD;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u6027\u80FD\u4F18\u5316-nginx\u4E8B\u4EF6\u5904\u7406\u6A21\u578B\u4F18\u5316use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> use </span><span style="color:#A6ACCD;">epoll</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7F51\u7EDC\u8FDE\u63A5\u7684\u4F18\u5316\u540C\u4E00\u65F6\u523B\u53EA\u6709\u4E00\u4E2A\u8BF7\u6C42\u800C\u907F\u514D\u591A\u4E2A\u7761\u7720\u8FDB\u7A0B\u88AB\u5524\u9192\u7684\u8BBE\u7F6E\uFF0Con\u4E3A\u9632\u6B62\u88AB\u540C\u65F6\u5524\u9192\uFF0C\u9ED8\u8BA4\u4E3Aoff\uFF0C\u56E0\u6B64nginx\u521A\u5B89\u88C5\u5B8C\u4EE5\u540E\u8981\u8FDB\u884C\u9002\u5F53\u7684\u4F18\u5316\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> accept_mutex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u6253\u5F00\u540C\u65F6\u63A5\u53D7\u591A\u4E2A\u65B0\u7F51\u7EDC\u8FDE\u63A5\u8BF7\u6C42\u7684\u529F\u80FD\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> multi_accept </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>\u518D\u6B21\u8BED\u6CD5\u68C0\u6D4B</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># /usr/local/nginx/sbin/nginx -t</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx: configuration file /usr/local/nginx/conf/nginx.conf </span><span style="color:#82AAFF;">test</span><span style="color:#A6ACCD;"> is successful</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u518D\u6B21\u91CD\u542F\u4E00\u4E0B<code>nginx</code>\u670D\u52A1</p><p>\u8BBE\u7F6E<code>ulimits</code>\u7684\u6700\u5927\u914D\u7F6E\uFF0C\u4E5F\u5C31\u662F\u6700\u5927\u6253\u5F00\u6587\u4EF6\u7684\u6570\u91CF</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># ulimit -SHn 65535</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7EE7\u7EED\u914D\u7F6E\uFF0C\u4E3B\u8981\u8BBE\u7F6E\u5728<code>http</code>\u6A21\u5757\u4E2D</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">      mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;"> application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u670D\u52A1\u5668\u540D\u5B57\u7684hash\u8868\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_names_hash_bucket_size </span><span style="color:#A6ACCD;">128</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7528\u4E8E\u6307\u5B9A\u6765\u81EA\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5934headerbuffer\u5927\u5C0F\uFF0C\u5BF9\u4E8E\u5927\u591A\u6570\u8BF7\u6C42\uFF0C1KB\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u5DF2\u7ECF\u8DB3\u591F\uFF0C\u5982\u679C\u81EA\u5B9A\u4E49\u4E86\u6D88\u606F\u5934\u6216\u6709\u66F4\u5927\u7684cookie\uFF0C\u53EF\u4EE5\u589E\u52A0\u7F13\u51B2\u533A\u5927\u5C0F\u3002\u8FD9\u91CC\u8BBE\u7F6E\u4E3A32KB</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> client_header_buffer_size </span><span style="color:#A6ACCD;">32k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7528\u6765\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BF7\u6C42\u4E2D\u8F83\u5927\u7684\u6D88\u606F\u5934\u7684\u7F13\u5B58\u6700\u5927\u6570\u91CF\u548C\u5927\u5C0F\uFF0C\u201C4\u201D\u4E3A\u4E2A\u6570\uFF0C\u201C128\u201D\u4E3A\u5927\u5C0F\uFF0C\u6700\u5927\u7F13\u5B58\u4E3A4\u4E2A128KB\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> large_client_header_buffers </span><span style="color:#A6ACCD;">4 </span><span style="color:#F78C6C;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5141\u8BB8\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5355\u6587\u4EF6\u5B57\u8282\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u63A5\u4E0B\u6765\u8FD8\u662F\u7EE7\u7EED\u5728<code>http</code>\u6A21\u5757\u91CC\u914D\u7F6E</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">sendfile </span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#676E95;">#\u5B83\u53EF\u4EE5\u914D\u7F6E\u4E00\u6B21\u53D1\u9001\u6570\u636E\u7684\u5305\u5927\u5C0F\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5B83\u4E0D\u662F\u6309\u65F6\u95F4\u7D2F\u8BA1  0.2 \u79D2\u540E\u53D1\u9001\u5305\uFF0C\u800C\u662F\u5F53\u5305\u7D2F\u8BA1\u5230\u4E00\u5B9A\u5927\u5C0F\u540E\u5C31\u53D1\u9001 \u5728 nginx \u4E2D\uFF0Ctcp_nopush \u5FC5\u987B\u548C sendfile \u642D\u914D\u4F7F\u7528\u3002</span></span>
<span class="line"><span style="color:#89DDFF;">tcp_nopush </span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u8BBE\u7F6E<code>keepalive_timeout</code>\u7684\u503C \u4E3A 15</p><blockquote><p>\u4FDD\u6301\u957F\u8FDE\u63A5\uFF0C\u51CF\u5C11\u521B\u5EFA\u8FDE\u63A5\u8FC7\u7A0B\u7ED9\u7CFB\u7EDF\u5E26\u6765\u7684\u6027\u80FD\u635F\u8017</p></blockquote><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#89DDFF;">keepalive_timeout </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u8BBE\u7F6E<code>TCP\u5EF6\u8FDF\u5904\u7406</code>\uFF0C\u4E5F\u662F\u5728<code>http</code>\u6A21\u5757\u4E2D</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#on \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u6570\u636E\u5C0F\u5305\u7684\u6570\u91CF\uFF0C\u4F46\u662F\u53EF\u4EE5\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6\u3002\u5728\u53CA\u65F6\u6027\u9AD8\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#676E95;">#off \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u901A\u4FE1\u7684\u5EF6\u65F6\uFF0C\u4F46\u662F\u4F1A\u63D0\u9AD8\u5E26\u5BBD\u5229\u7528\u7387\u3002\u5728\u9AD8\u5EF6\u65F6\u3001\u6570\u636E\u91CF\u5927\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#89DDFF;">tcp_nodelay </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u8BBE\u7F6E<code>fastcgi</code>\u914D\u7F6E\uFF0C\u4E5F\u662F\u5728<code>http</code>\u6A21\u5757\u4E2D</p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#\u8FDE\u63A5\u5230\u540E\u7AEFfastcgi\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_connect_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5411fastcgi\u8BF7\u6C42\u8D85\u65F6\u65F6\u95F4(\u8FD9\u4E2A\u6307\u5B9A\u503C\u5DF2\u7ECF\u5B8C\u6210\u4E24\u6B21\u63E1\u624B\u540E\u5411fastcgi\u4F20\u9001\u8BF7\u6C42\u7684\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_send_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u63A5\u6536fastcgi\u5E94\u7B54\u8D85\u65F6\u65F6\u95F4\uFF0C\u540C\u7406\u4E5F\u662F2\u6B21\u63E1\u624B\u540E</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_read_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u8BFB\u53D6fastcgi\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206\u9700\u8981\u591A\u5927\u7F13\u51B2\u533A\uFF0C\u8BE5\u503C\u8868\u793A\u4F7F\u75281\u4E2A64kb\u7684\u7F13\u51B2\u533A\u8BFB\u53D6\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206(\u5E94\u7B54\u5934),\u53EF\u4EE5\u8BBE\u7F6E\u4E3Afastcgi_buffers\u9009\u9879\u7F13\u51B2\u533A\u5927\u5C0F</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_buffer_size </span><span style="color:#A6ACCD;">64k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u6307\u5B9A\u672C\u5730\u9700\u8981\u591A\u5C11\u548C\u591A\u5927\u7684\u7F13\u51B2\u533A\u6765\u7F13\u51B2fastcgi\u5E94\u7B54\u8BF7\u6C42\uFF0C\u5047\u8BBE\u4E00\u4E2Aphp\u6216java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E3A256kb,\u90A3\u4E48\u4F1A\u4E3A\u5176\u5206\u914D4\u4E2A64kb\u7684\u7F13\u51B2\u6765\u7F13\u5B58\uFF1B\u82E5\u9875\u9762\u5927\u4E8E256kb,\u90A3\u4E48\u5927\u4E8E\u7684256kb\u7684\u90E8\u5206\u4F1A\u7F13\u5B58\u5230fastcgi_temp\u6307\u5B9A\u8DEF\u5F84\u4E2D\uFF0C\u8FD9\u5E76\u975E\u662F\u4E2A\u597D\u529E\u6CD5\uFF0C\u5185\u5B58\u6570\u636E\u5904\u7406\u5FEB\u4E8E\u786C\u76D8\uFF0C\u4E00\u822C\u8BE5\u503C\u5E94\u8BE5\u4E3A\u7AD9\u70B9\u4E2Dphp/java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E2D\u95F4\u503C\uFF0C\u5982\u679C\u7AD9\u70B9\u5927\u90E8\u5206\u811A\u672C\u6240\u4EA7\u751F\u7684\u9875\u9762\u5927\u5C0F\u4E3A256kb\uFF0C\u90A3\u4E48\u53EF\u628A\u503C\u8BBE\u7F6E\u4E3A16 16k,4 64k\u7B49</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_buffers </span><span style="color:#A6ACCD;">4 </span><span style="color:#F78C6C;">64k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_busy_buffers_size </span><span style="color:#A6ACCD;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5199\u5165\u7F13\u5B58\u6587\u4EF6\u4F7F\u7528\u591A\u5927\u7684\u6570\u636E\u5757\uFF0C\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_temp_file_write_size </span><span style="color:#A6ACCD;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#\u7F13\u5B58\u8DEF\u5F84\u6587\u4EF6\uFF0C\u76EE\u5F55\u7ED3\u6784\u7B49\u7EA7\uFF0C\u5173\u952E\u5B57\u533A\u57DF\u5B9E\u9645\u548C\u975E\u6D3B\u52A8\u65F6\u95F4</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_path </span><span style="color:#A6ACCD;"> /usr/local/nginx/fastcgi_cache levels=1:2 keys_zone=TEST:10m inactive=5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u7F13\u5B58\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_key </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_method</span><span style="color:#C3E88D;">://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u8BE5\u6307\u4EE4\u7528\u4E8E\u8BBE\u7F6E\u7F13\u5B58\u54EA\u4E9BHTTP\u65B9\u6CD5\uFF0C\u9ED8\u8BA4\u7F13\u5B58HTTP GET/HEAD\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_methods </span><span style="color:#A6ACCD;">GET HEAD</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5F00\u542Ffastcgi\u7F13\u5B58\u5E76\u4E3A\u5176\u6307\u5B9A\u4E3ATEST\u540D\u79F0\uFF0C\u964D\u4F4Ecpu\u8D1F\u8F7D,\u9632\u6B62502\u9519\u8BEF\u53D1\u751F.</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache </span><span style="color:#A6ACCD;">TEST</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5E94\u7B54\u4EE3\u7801\u7F13\u5B58\u65F6\u95F4\uFF0C200\u548C302\u5E94\u7B54\u7F13\u5B58\u4E3A1\u4E2A\u5C0F\u65F6\uFF0C301\u4E00\u5929,\u5176\u4ED61\u5206\u949F</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_valid </span><span style="color:#A6ACCD;">200 </span><span style="color:#F78C6C;">302</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_valid </span><span style="color:#A6ACCD;">301 </span><span style="color:#F78C6C;">1d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">fastcgi_cache_valid </span><span style="color:#A6ACCD;">any </span><span style="color:#F78C6C;">1m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>\u4E0A\u9762\u7684\u7F13\u5B58<code>fastcgi_cache</code>\u76EE\u5F55\u9700\u8981\u6211\u4EEC\u63D0\u524D\u521B\u5EFA\u4E00\u4E0B</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir -p /usr/local/nginx/fastcgi_cache</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># \u6743\u9650</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R nginx.nginx /usr/local/nginx</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5F00\u542F<code>fascgi_cache</code>\u4E4B\u540E\u4F1A\u591A\u51E0\u4E2A\u8FDB\u7A0B\u542F\u52A8</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@10 </span><span style="color:#89DDFF;">~]</span><span style="color:#676E95;"># ps -ef | grep nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">root     19828     1  0 19:18 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    19860 19828  1 19:38 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 nginx: worker process</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    19861 19828  0 19:38 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 nginx: worker process</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    19862 19828  0 19:38 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 nginx: cache manager process</span></span>
<span class="line"><span style="color:#A6ACCD;">nginx    19863 19828  0 19:38 </span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">        00:00:00 nginx: cache loader process</span></span>
<span class="line"><span style="color:#A6ACCD;">root     19865 19695  0 19:38 pts/0    00:00:00 grep --color=auto nginx</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u6240\u4EE5\u4E0B\u6B21\u4F60\u6539\u9875\u9762\u3010PHP\u3011\u7684\u65F6\u5019\uFF0C\u4E0D\u4E00\u5B9A\u4F1A\u5373\u65F6\u751F\u6548\uFF0C\u56E0\u4E3A\u6709\u7F13\u5B58</p><p>\u8BBE\u7F6E\u9690\u85CF\u7248\u672C\u53F7</p><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/4021/20220813221425.png" alt=""></p><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;"># \u9690\u85CF\u7248\u672C\u53F7</span></span>
<span class="line"><span style="color:#89DDFF;">server_tokens </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u518D\u6B21\u9A8C\u8BC1\u91CD\u8F7D\u914D\u7F6E\u4E4B\u540E\uFF0C\u5237\u65B0\u9875\u9762\uFF0C\u6B64\u65F6\u7248\u672C\u53F7\u5C31\u4F1A\u6D88\u5931</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">Server: nginx</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="\u6700\u7EC8\u914D\u7F6E\u5185\u5BB9" tabindex="-1">\u6700\u7EC8\u914D\u7F6E\u5185\u5BB9 <a class="header-anchor" href="#\u6700\u7EC8\u914D\u7F6E\u5185\u5BB9" aria-hidden="true">#</a></h3><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#676E95;">#user\u662F\u4E3B\u6A21\u5757\u6307\u4EE4\uFF0C\u5B9A\u4E49Nginx\u8FD0\u884C\u7684\u7528\u6237\u548C\u7528\u6237\u7EC4</span></span>
<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#A6ACCD;">nginx nginx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u5DE5\u4F5C\u8FDB\u7A0B\u6570 \u8BBE\u7F6E\u4E3A\u81EA\u52A8</span></span>
<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#A6ACCD;">auto</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#nginx\u9ED8\u8BA4\u662F\u6CA1\u6709\u5F00\u542F\u5229\u7528\u591A\u6838cpu\u7684\u914D\u7F6E\u7684\u3002\u9700\u8981\u901A\u8FC7\u589E\u52A0worker_cpu_affinity\u914D\u7F6E\u53C2\u6570\u6765\u5145\u5206\u5229\u7528\u591A\u6838cpu\uFF0Ccpu\u662F\u4EFB\u52A1\u5904\u7406\uFF0C\u5F53\u8BA1\u7B97\u6700\u8D39\u65F6\u7684\u8D44\u6E90\u7684\u65F6\u5019\uFF0Ccpu\u6838\u4F7F\u7528\u4E0A\u7684\u8D8A\u591A\uFF0C\u6027\u80FD\u5C31\u8D8A\u597D</span></span>
<span class="line"><span style="color:#89DDFF;">worker_cpu_affinity </span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">#\u8FDB\u7A0B\u6700\u5927\u53EF\u6253\u5F00\u6587\u4EF6\u6570</span></span>
<span class="line"><span style="color:#89DDFF;">worker_rlimit_nofile </span><span style="color:#A6ACCD;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="color:#676E95;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">events</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5355\u4E2A\u5DE5\u4F5C\u8FDB\u7A0B\u53EF\u4EE5\u5141\u8BB8\u540C\u65F6\u5EFA\u7ACB\u5916\u90E8\u8FDE\u63A5\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> worker_connections </span><span style="color:#A6ACCD;">65535</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u6027\u80FD\u4F18\u5316-nginx\u4E8B\u4EF6\u5904\u7406\u6A21\u578B\u4F18\u5316use epoll;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> use </span><span style="color:#A6ACCD;">epoll</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7F51\u7EDC\u8FDE\u63A5\u7684\u4F18\u5316\u540C\u4E00\u65F6\u523B\u53EA\u6709\u4E00\u4E2A\u8BF7\u6C42\u800C\u907F\u514D\u591A\u4E2A\u7761\u7720\u8FDB\u7A0B\u88AB\u5524\u9192\u7684\u8BBE\u7F6E\uFF0Con\u4E3A\u9632\u6B62\u88AB\u540C\u65F6\u5524\u9192\uFF0C\u9ED8\u8BA4\u4E3Aoff\uFF0C\u56E0\u6B64nginx\u521A\u5B89\u88C5\u5B8C\u4EE5\u540E\u8981\u8FDB\u884C\u9002\u5F53\u7684\u4F18\u5316\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> accept_mutex </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u6253\u5F00\u540C\u65F6\u63A5\u53D7\u591A\u4E2A\u65B0\u7F51\u7EDC\u8FDE\u63A5\u8BF7\u6C42\u7684\u529F\u80FD\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> multi_accept </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">http</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">      mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> default_type </span><span style="color:#A6ACCD;"> application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u670D\u52A1\u5668\u540D\u5B57\u7684hash\u8868\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_names_hash_bucket_size </span><span style="color:#A6ACCD;">128</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7528\u4E8E\u6307\u5B9A\u6765\u81EA\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5934headerbuffer\u5927\u5C0F\uFF0C\u5BF9\u4E8E\u5927\u591A\u6570\u8BF7\u6C42\uFF0C1KB\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u5DF2\u7ECF\u8DB3\u591F\uFF0C\u5982\u679C\u81EA\u5B9A\u4E49\u4E86\u6D88\u606F\u5934\u6216\u6709\u66F4\u5927\u7684cookie\uFF0C\u53EF\u4EE5\u589E\u52A0\u7F13\u51B2\u533A\u5927\u5C0F\u3002\u8FD9\u91CC\u8BBE\u7F6E\u4E3A32KB</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> client_header_buffer_size </span><span style="color:#A6ACCD;">32k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7528\u6765\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BF7\u6C42\u4E2D\u8F83\u5927\u7684\u6D88\u606F\u5934\u7684\u7F13\u5B58\u6700\u5927\u6570\u91CF\u548C\u5927\u5C0F\uFF0C\u201C4\u201D\u4E3A\u4E2A\u6570\uFF0C\u201C128\u201D\u4E3A\u5927\u5C0F\uFF0C\u6700\u5927\u7F13\u5B58\u4E3A4\u4E2A128KB\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> large_client_header_buffers </span><span style="color:#A6ACCD;">4 </span><span style="color:#F78C6C;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5141\u8BB8\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5355\u6587\u4EF6\u5B57\u8282\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> client_max_body_size </span><span style="color:#A6ACCD;">10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#access_log  logs/access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> sendfile </span><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u5B83\u53EF\u4EE5\u914D\u7F6E\u4E00\u6B21\u53D1\u9001\u6570\u636E\u7684\u5305\u5927\u5C0F\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5B83\u4E0D\u662F\u6309\u65F6\u95F4\u7D2F\u8BA1  0.2 \u79D2\u540E\u53D1\u9001\u5305\uFF0C\u800C\u662F\u5F53\u5305\u7D2F\u8BA1\u5230\u4E00\u5B9A\u5927\u5C0F\u540E\u5C31\u53D1\u9001 \u5728 nginx \u4E2D\uFF0Ctcp_nopush \u5FC5\u987B\u548C sendfile \u642D\u914D\u4F7F\u7528\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nopush </span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#keepalive_timeout  0;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u53C2\u6570\u662F\u4E00\u4E2A\u8BF7\u6C42\u5B8C\u6210\u4E4B\u540E\u8FD8\u8981\u4FDD\u6301\u8FDE\u63A5\u591A\u4E45\uFF0C\u4E0D\u662F\u8BF7\u6C42\u65F6\u95F4\u591A\u4E45\uFF0C\u76EE\u7684\u662F\u4FDD\u6301\u957F\u8FDE\u63A5\uFF0C\u51CF\u5C11\u521B\u5EFA\u8FDE\u63A5\u8FC7\u7A0B\u7ED9\u7CFB\u7EDF\u5E26\u6765\u7684\u6027\u80FD\u635F\u8017\uFF0C\u7C7B\u4F3C\u4E8E\u7EBF\u7A0B\u6C60\uFF0C\u6570\u636E\u5E93\u8FDE\u63A5\u6C60</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> keepalive_timeout </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#on \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u6570\u636E\u5C0F\u5305\u7684\u6570\u91CF\uFF0C\u4F46\u662F\u53EF\u4EE5\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6\u3002\u5728\u53CA\u65F6\u6027\u9AD8\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#off \u4F1A\u589E\u52A0\u7531tcp\u534F\u8BAE\u901A\u4FE1\u7684\u5EF6\u65F6\uFF0C\u4F46\u662F\u4F1A\u63D0\u9AD8\u5E26\u5BBD\u5229\u7528\u7387\u3002\u5728\u9AD8\u5EF6\u65F6\u3001\u6570\u636E\u91CF\u5927\u7684\u901A\u4FE1\u573A\u666F\u4E2D\u5E94\u8BE5\u4F1A\u6709\u4E0D\u9519\u7684\u6548\u679C</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> tcp_nodelay </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#gzip  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u8FDE\u63A5\u5230\u540E\u7AEFfastcgi\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_connect_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5411fastcgi\u8BF7\u6C42\u8D85\u65F6\u65F6\u95F4(\u8FD9\u4E2A\u6307\u5B9A\u503C\u5DF2\u7ECF\u5B8C\u6210\u4E24\u6B21\u63E1\u624B\u540E\u5411fastcgi\u4F20\u9001\u8BF7\u6C42\u7684\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_send_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u63A5\u6536fastcgi\u5E94\u7B54\u8D85\u65F6\u65F6\u95F4\uFF0C\u540C\u7406\u4E5F\u662F2\u6B21\u63E1\u624B\u540E</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_read_timeout </span><span style="color:#A6ACCD;">300</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u8BFB\u53D6fastcgi\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206\u9700\u8981\u591A\u5927\u7F13\u51B2\u533A\uFF0C\u8BE5\u503C\u8868\u793A\u4F7F\u75281\u4E2A64kb\u7684\u7F13\u51B2\u533A\u8BFB\u53D6\u5E94\u7B54\u7B2C\u4E00\u90E8\u5206(\u5E94\u7B54\u5934),\u53EF\u4EE5\u8BBE\u7F6E\u4E3Afastcgi_buffers\u9009\u9879\u7F13\u51B2\u533A\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_buffer_size </span><span style="color:#A6ACCD;">64k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u6307\u5B9A\u672C\u5730\u9700\u8981\u591A\u5C11\u548C\u591A\u5927\u7684\u7F13\u51B2\u533A\u6765\u7F13\u51B2fastcgi\u5E94\u7B54\u8BF7\u6C42\uFF0C\u5047\u8BBE\u4E00\u4E2Aphp\u6216java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E3A256kb,\u90A3\u4E48\u4F1A\u4E3A\u5176\u5206\u914D4\u4E2A64kb\u7684\u7F13\u51B2\u6765\u7F13\u5B58\uFF1B\u82E5\u9875\u9762\u5927\u4E8E256kb,\u90A3\u4E48\u5927\u4E8E\u7684256kb\u7684\u90E8\u5206\u4F1A\u7F13\u5B58\u5230fastcgi_temp\u6307\u5B9A\u8DEF\u5F84\u4E2D\uFF0C\u8FD9\u5E76\u975E\u662F\u4E2A\u597D\u529E\u6CD5\uFF0C\u5185\u5B58\u6570\u636E\u5904\u7406\u5FEB\u4E8E\u786C\u76D8\uFF0C\u4E00\u822C\u8BE5\u503C\u5E94\u8BE5\u4E3A\u7AD9\u70B9\u4E2Dphp/java\u811A\u672C\u6240\u4EA7\u751F\u9875\u9762\u5927\u5C0F\u4E2D\u95F4\u503C\uFF0C\u5982\u679C\u7AD9\u70B9\u5927\u90E8\u5206\u811A\u672C\u6240\u4EA7\u751F\u7684\u9875\u9762\u5927\u5C0F\u4E3A256kb\uFF0C\u90A3\u4E48\u53EF\u628A\u503C\u8BBE\u7F6E\u4E3A16 16k,4 64k\u7B49</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_buffers </span><span style="color:#A6ACCD;">4 </span><span style="color:#F78C6C;">64k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_busy_buffers_size </span><span style="color:#A6ACCD;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u5199\u5165\u7F13\u5B58\u6587\u4EF6\u4F7F\u7528\u591A\u5927\u7684\u6570\u636E\u5757\uFF0C\u9ED8\u8BA4\u503C\u662Ffastcgi_buffer\u76842\u500D</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> fastcgi_temp_file_write_size </span><span style="color:#A6ACCD;">128k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#\u7F13\u5B58\u8DEF\u5F84\u6587\u4EF6\uFF0C\u76EE\u5F55\u7ED3\u6784\u7B49\u7EA7\uFF0C\u5173\u952E\u5B57\u533A\u57DF\u5B9E\u9645\u548C\u975E\u6D3B\u52A8\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_path </span><span style="color:#A6ACCD;"> /usr/local/nginx/fastcgi_cache levels=1:2 keys_zone=TEST:10m inactive=5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u7F13\u5B58\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_key </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_method</span><span style="color:#C3E88D;">://</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request_uri</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u8BE5\u6307\u4EE4\u7528\u4E8E\u8BBE\u7F6E\u7F13\u5B58\u54EA\u4E9BHTTP\u65B9\u6CD5\uFF0C\u9ED8\u8BA4\u7F13\u5B58HTTP GET/HEAD\u65B9\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_methods </span><span style="color:#A6ACCD;">GET HEAD</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u5F00\u542Ffastcgi\u7F13\u5B58\u5E76\u4E3A\u5176\u6307\u5B9A\u4E3ATEST\u540D\u79F0\uFF0C\u964D\u4F4Ecpu\u8D1F\u8F7D,\u9632\u6B62502\u9519\u8BEF\u53D1\u751F.</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache </span><span style="color:#A6ACCD;">TEST</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u5E94\u7B54\u4EE3\u7801\u7F13\u5B58\u65F6\u95F4\uFF0C200\u548C302\u5E94\u7B54\u7F13\u5B58\u4E3A1\u4E2A\u5C0F\u65F6\uFF0C301\u4E00\u5929,\u5176\u4ED61\u5206\u949F</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_valid </span><span style="color:#A6ACCD;">200 </span><span style="color:#F78C6C;">302</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_valid </span><span style="color:#A6ACCD;">301 </span><span style="color:#F78C6C;">1d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> fastcgi_cache_valid </span><span style="color:#A6ACCD;">any </span><span style="color:#F78C6C;">1m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># \u9690\u85CF\u7248\u672C\u53F7</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_tokens </span><span style="color:#A6ACCD;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#charset koi8-r;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  /home/web/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;"> index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;"> error_page </span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">502</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">503</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">504</span><span style="color:#A6ACCD;">  /50x.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/50x.html </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">  html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#location ~ \\.php$ {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    proxy_pass   http://127.0.0.1;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#location ~ \\.php$ {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    root           html;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    fastcgi_pass   127.0.0.1:9000;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    fastcgi_index  index.php;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    include        fastcgi_params;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># deny access to .htaccess files, if Apache&#39;s document root</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;"># concurs with nginx&#39;s one</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#location ~ /\\.ht {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#    deny  all;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;">#}</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># another virtual host using mix of IP-, name-, and port-based configuration</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    listen       8000;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    listen       somename:8080;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    server_name  somename  alias  another.alias;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#        root   html;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#        index  index.html index.htm;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;"># HTTPS server</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#server {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    listen       443 ssl;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    server_name  localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_certificate      cert.pem;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_certificate_key  cert.key;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_session_cache    shared:SSL:1m;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_session_timeout  5m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    ssl_prefer_server_ciphers  on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#        root   html;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#        index  index.html index.htm;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">#1.\u5F00\u542Fgzip\u538B\u7F29</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u5F00\u542F\u6807\u5FD7</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u6587\u4EF6\u5927\u5C0F\u672A\u8FBE\u5230\u8BE5\u503C\uFF0C\u4E0D\u538B\u7F29 \u6587\u4EF6\u5DF2\u8FBE\u5230\u8BE5\u503C\uFF0C\u538B\u7F29</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u7528\u4E8E\u8BBE\u7F6EGzip\u538B\u7F29\u6587\u4EF6\u4F7F\u7528\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F number:\u5411\u7CFB\u7EDF\u7533\u8BF7\u6362\u7C97\u7A7A\u95F4\u7684\u4E2A\u6570\uFF0Csize\uFF1A\u6307\u5B9A\u6BCF\u4E2A\u7F13\u5B58\u7A7A\u95F4\u7684\u5927\u5C0F\uFF0C\u4E00\u822C\u53D6\u7CFB\u7EDF\u5185\u5B58\u9875\u4E00\u9875\u7684\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_buffers </span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u53C2\u6570\u503C\uFF1A1.0 | 1.1\uFF0C\u6CE8\u610F\uFF0C\u6B64\u5904\u53EA\u80FD\u662F1.0\uFF0C\u6216\u80051.1\u3002\u8BBE\u7F6E\u538B\u7F29\u54CD\u5E94\u6240\u9700\u7684\u6700\u5C0Fhttp\u534F\u8BAE\u7248\u672C</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_http_version </span><span style="color:#A6ACCD;">1.0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u8BBE\u7F6Egzip\u538B\u7F29\u7A0B\u5EA6\uFF0C\u5305\u62EC1~9\u7EA7\u522B\uFF0C1\u6700\u4F4E\uFF0C9\u6700\u9AD8\uFF0C\u9ED8\u8BA4\u4E3A1</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_comp_level </span><span style="color:#A6ACCD;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u53C2\u6570\u503C\uFF1A\u54CD\u5E94\u62A5\u6587\u6570\u636E\u683C\u5F0F\uFF0C\u6216\u8005\u8BF4\u7C7B\u578B\uFF0C\u5BF9\u5E94http\u54CD\u5E94\u5934\u4E2D\u7684Content-type\u5B57\u6BB5\uFF0C\u5982\u5E38\u89C1\u7684\u6709text/html\u3001text/css\u3001application/json\u3001application/javaScript\u7B49\u3002\u7528\u4E8E\u6307\u5B9A\u8981\u538B\u7F29\u7684\u54CD\u5E94\u62A5\u6587\u7C7B\u578B\u3002\u201D*\u201D\u8868\u793A\u538B\u7F29\u6240\u6709\u683C\u5F0F\u7684\u54CD\u5E94\u62A5\u6587\uFF0C\u591A\u79CD\u683C\u5F0F\u7528\u7A7A\u683C\u9694\u5F00\u3002\u5982text/html text/css\u3002\u9ED8\u8BA4\u503C\uFF1Atext/html</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_types </span><span style="color:#A6ACCD;">      text/plain application/x-javascript text/css application/xml</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u7528\u4E8E\u8BBE\u7F6E\u5728\u8FDB\u884Cgzip\u538B\u7F29\u65F6\u662F\u5426\u53D1\u9001\u5E26\u6709Vary:Accept-Encoding\u5934\u57DF\u7684\u54CD\u5E94\u5934\u90E8\uFF1Bgzip_vary on | off</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_vary </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">#\u6839\u636E\u4E0D\u540C\u7684\u5BA2\u6237\u7AEF\u8BF7\u6C42\u9009\u62E9\u6027\u7684\u5F00\u542F\u6216\u5173\u95EDgzip\u6307\u4EE4gzip_disable MSIE [4-6]\\. \u5BF9IE4-6\u4E0D\u5F00\u542Fgzip\u538B\u7F29</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> gzip_disable </span><span style="color:#A6ACCD;">msie6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;"># nginx\u65E5\u5FD7\u8BB0\u5F55\u683C\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> log_format </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">status</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">&#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">vhost/*.conf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br></div></div><h2 id="\u8D1F\u8F7D\u5747\u8861" tabindex="-1">\u8D1F\u8F7D\u5747\u8861 <a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a></h2><p><a href="http://tengine.taobao.org/book/chapter_05.html" target="_blank" rel="noreferrer">http://tengine.taobao.org/book/chapter_05.html</a></p><p><code>weight</code>\u6743\u91CD\u8D8A\u9AD8\uFF0C\u51FA\u73B0\u9891\u7387\u8D8A\u9AD8</p><blockquote><p>\u6307\u5B9A\u8F6E\u8BE2\u51E0\u7387\uFF0Cweight \u548C\u8BBF\u95EE\u6BD4\u7387\u6210\u6B63\u6BD4\uFF0C\u7528\u4E8E\u540E\u7AEF\u670D\u52A1\u5668\u6027\u80FD\u4E0D\u5747\u7684\u60C5\u51B5\u3002 \u5982\u679C\u540E\u7AEF\u670D\u52A1\u5668 down \u6389\uFF0C\u80FD\u81EA\u52A8\u5254\u9664\u3002 \u6BD4\u5982\u4EE5\u4E0B\u914D\u7F6E\uFF0C\u5219 1.11 \u670D\u52A1\u5668\u7684\u8BBF\u95EE\u91CF\u4E3A 1.10 \u670D\u52A1\u5668\u7684\u4E24\u500D\u3002</p></blockquote><div class="language-nginx line-numbers-mode"><button class="copy"></button><span class="lang">nginx</span><pre><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">easyswoole_server </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">server</span><span style="color:#A6ACCD;"> 127.0.0.1:9501 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server 127.0.0.1:9502 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server 127.0.0.1:9503 </span><span style="color:#A6ACCD;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">     listen       </span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> www.easyswoole.tt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> root </span><span style="color:#A6ACCD;">/home/web/easyswoole/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> ssi </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> ssi_silent_errors </span><span style="color:#A6ACCD;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;"> index.php index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> proxy_http_version </span><span style="color:#A6ACCD;">1.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Connection </span><span style="color:#C3E88D;">&quot;keep-alive&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!-f $</span><span style="color:#A6ACCD;">request_filename) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;">#proxy_pass http://127.0.0.1:9501;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#F07178;">http://easyswoole_server</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">~</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\\.php$ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> fastcgi_pass </span><span style="color:#A6ACCD;">  127.0.0.1:9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> fastcgi_index </span><span style="color:#A6ACCD;"> index.php</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> fastcgi_param </span><span style="color:#A6ACCD;"> SCRIPT_FILENAME  </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">document_root</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">fastcgi_script_name</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;"> include </span><span style="color:#A6ACCD;">       fastcgi_params</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> access_log </span><span style="color:#A6ACCD;"> /usr/local/nginx/logs/php7_access.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;"> error_log </span><span style="color:#A6ACCD;">/usr/local/nginx/logs/php7_error.log</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div>`,103),o=[e];function c(r,t,i,D,y,C){return a(),n("div",null,o)}const u=s(p,[["render",c]]);export{A as __pageData,u as default};
